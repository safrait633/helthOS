<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Neumol√≥gico - Algoritmo de Evaluaci√≥n Avanzado</title>
    <link rel="stylesheet" href="./styles/main.css">
    <style>
        /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–Ω–µ–≤–º–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —ç–∫–∑–∞–º–µ–Ω–∞ */
        body {
            padding-top: 160px;
        }
        
        /* –î–∞—à–±–æ—Ä–¥ —Å—Ç–∏–ª–∏ —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ dashboard.css */



        .update-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--primary-gradient);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: none;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            z-index: 10;
        }

        .update-indicator.active {
            display: flex;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notificaci√≥n de copia */
        .copy-notification {
            position: fixed;
            top: 200px;
            right: 20px;
            background: var(--normal-color);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.3s ease;
            z-index: 1002;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .copy-notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        /* Ajustar contenido principal cuando panel est√° activo */
        .split-view-active .main-container {
            margin-right: 420px;
            transition: margin-right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* üé® CONTENEDOR PRINCIPAL CON VISTA DIVIDIDA */
        .main-container {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 30px;
            margin: 0 20px;
            transition: all 0.3s ease;
        }

        .split-view .main-container {
            margin-left: 320px;
            margin-right: 20px;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            padding-bottom: 15px;
        }

        /* ‚úÖ SECCIONES MEJORADAS */
        .section {
            margin-bottom: 25px;
            border: 2px solid #bdc3c7;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            background: var(--card-bg);
        }
        
        .section.active {
            border-color: #1abc9c;
            box-shadow: 0 4px 15px rgba(26, 188, 156, 0.15);
        }

        .section.hidden {
            display: none;
        }
        
        .section-header {
            background: var(--primary-gradient);
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .section-header:hover {
            background: linear-gradient(135deg, #16a085, #138d75);
            box-shadow: inset 0 0 20px rgba(255,255,255,0.1);
        }
        
        .section-header .arrow {
            transition: transform 0.3s ease;
            font-size: 18px;
        }
        
        .section-header.expanded .arrow {
            transform: rotate(180deg);
        }

        .section-header .completion-badge {
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 10px;
        }

        .section-header .completion-badge.completed {
            background: var(--normal-color);
        }
        
        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
            background: var(--light-bg);
        }
        
        .section-content.expanded {
            padding: 20px;
        }
        
        /* üìã CONTENEDORES DE EXAMEN MEJORADOS */
        .exam-container {
            background: var(--card-bg);
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .exam-container:hover {
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .exam-header {
            font-size: 18px;
            font-weight: 600;
            background: var(--secondary-gradient);
            color: white;
            margin: -20px -20px 15px -20px;
            padding: 12px 20px;
            border-radius: 8px 8px 0 0;
        }
        
        .exam-section {
            background: var(--light-bg);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .exam-section h4 {
            color: #2c3e50;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .sub-header {
            color: #1abc9c;
            margin: 15px 0 8px 0;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ‚úÖ GRID DE CHECKBOXES MEJORADO */
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: rgba(26, 188, 156, 0.05);
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin: 0;
            accent-color: var(--normal-color);
        }

        .checkbox-item input[type="radio"] {
            width: 16px;
            height: 16px;
            margin: 0;
            accent-color: var(--normal-color);
        }
        
        .checkbox-item label {
            font-size: 13px;
            color: #2c3e50;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .checkbox-item input:checked + label {
            color: var(--normal-color);
            font-weight: 500;
        }

        /* üåô MODO OSCURO */
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* üè† BOT√ìN HOME MEJORADO */
        .home-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--normal-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1001;
            transition: all 0.3s ease;
        }
        
        .home-button:hover {
            background-color: #16a085;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        /* ELEMENTOS ESPEC√çFICOS NEUMOL√ìGICOS */
        .bilateral-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 10px;
        }
        
        .side-container {
            padding: 15px;
            background: #ffffff;
            border: 1px solid #e8ecef;
            border-radius: 6px;
        }
        
        .side-header {
            font-weight: 600;
            font-size: 14px;
            color: #34495e;
            margin-bottom: 12px;
            text-align: center;
            border-bottom: 1px solid #f0f3f4;
            padding-bottom: 8px;
        }

        .respiratory-assessment {
            background: #e8f8f5;
            border: 1px solid #1abc9c;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .respiratory-assessment h4 {
            color: #138d75;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .dyspnea-assessment {
            background: #fff3e0;
            border: 1px solid #f39c12;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .dyspnea-assessment h4 {
            color: #e67e22;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .severity-section {
            background: #fdf2f2;
            border: 1px solid #e74c3c;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .severity-section h4 {
            color: #c53030;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .severity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 8px;
        }

        .severity-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 3px;
        }

        .severity-item input[type="radio"] {
            width: 14px;
            height: 14px;
        }

        .severity-item label {
            font-size: 12px;
            color: #c53030;
            cursor: pointer;
        }
        
        .lung-map {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .lung-side {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            background: white;
        }

        .lung-side h5 {
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            color: #1abc9c;
        }

        .lung-zone {
            background: #f8f9fa;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .lung-zone h6 {
            margin: 0 0 8px 0;
            font-size: 12px;
            font-weight: 600;
            color: #2c3e50;
        }

        .lung-findings {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            font-size: 10px;
        }

        .lung-findings label {
            display: flex;
            align-items: center;
            gap: 3px;
            font-size: 10px;
        }

        .lung-findings input {
            width: 12px;
            height: 12px;
        }

        .score-calculation {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            font-size: 13px;
        }

        .score-value {
            font-weight: 600;
            color: #2e7d32;
        }

        .cough-assessment {
            background: #fef5e7;
            border: 1px solid #f39c12;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .cough-assessment h4 {
            color: #d68910;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .saturation-assessment {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .saturation-assessment h4 {
            color: #1976d2;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .spirometry-assessment {
            background: #f3e5f5;
            border: 1px solid #9c27b0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .spirometry-assessment h4 {
            color: #7b1fa2;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .measurement {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
        }
        
        .measurement label {
            font-size: 12px;
            color: #5d6d7e;
            flex-basis: 120px;
            flex-shrink: 0;
        }
        
        .input-field {
            width: 80px;
            padding: 6px 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #1abc9c;
            box-shadow: 0 0 0 3px rgba(26, 188, 156, 0.1);
        }

        .positive { color: #e74c3c !important; }
        .negative { color: #27ae60 !important; }
        .abnormal { color: #f39c12 !important; }

        .test-results {
            margin-top: 10px;
        }
        
        .test-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            padding: 8px 12px;
            margin: 4px 0;
            background: var(--card-bg);
            border: 1px solid #e8ecef;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .test-item:hover {
            border-color: #1abc9c;
            box-shadow: 0 2px 8px rgba(26, 188, 156, 0.1);
        }
        
        .test-item label {
            font-size: 12px;
            color: #2c3e50;
            flex-grow: 1;
            margin-right: 10px;
        }
        
        .test-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .test-checkbox {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .test-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        
        .test-checkbox span {
            font-size: 12px;
            font-weight: 600;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 12px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .respiratory-color { background-color: #1abc9c; }
        .dyspnea-color { background-color: #e67e22; }
        .cough-color { background-color: #d68910; }

        .description-area {
            width: 100%;
            min-height: 60px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            resize: vertical;
        }

        .conclusion {
            margin-top: 30px;
            padding: 25px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 2px solid #dee2e6;
            position: relative;
            overflow: hidden;
        }

        .conclusion::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }
        
        .conclusion h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .conclusion-text {
            padding: 20px;
            background: var(--light-bg);
            border-radius: 8px;
            border: 1px solid #dee2e6;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            font-size: 13px;
            line-height: 1.5;
        }

        /* üéõÔ∏è BOTONES DE CONTROL MEJORADOS */
        .control-buttons {
            margin-top: 25px;
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background-color: #1abc9c;
            color: white;
        }

        .btn-primary:hover {
            background-color: #16a085;
        }

        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        /* Funci√≥n auxiliar para auto-rellenar campos espec√≠ficos */
        .auto-populate {
            background: rgba(26, 188, 156, 0.1);
            border: 1px solid var(--normal-color);
            color: var(--normal-color);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 5px;
            cursor: pointer;
        }

        /* üì± RESPONSIVIDAD MEJORADA */
        @media (max-width: 1200px) {
            .sticky-panel {
                width: 350px;
            }
            
            .split-view-active .main-container {
                margin-right: 370px;
            }
        }

        @media (max-width: 768px) {
            body { padding-top: 120px; }
            
            .control-bar {
                position: relative;
                top: auto;
                right: auto;
                justify-content: center;
                margin: 10px 0;
            }
            
            .nav-panel {
                transform: translateX(-100%);
                width: calc(100vw - 40px);
            }
            
            .main-container {
                margin: 0 10px;
            }
            
            .split-view .main-container {
                margin-left: 10px;
            }

            .sticky-panel {
                width: calc(100vw - 20px);
                right: -100vw;
                left: 10px;
                border-radius: 12px;
            }
            
            .sticky-panel.active {
                right: auto;
                left: 10px;
            }
            
            .split-view-active .main-container {
                margin-right: 10px;
            }
            
            .checkbox-grid {
                grid-template-columns: 1fr;
            }
            
            .bilateral-container {
                grid-template-columns: 1fr;
            }
        }

        /* ‚ö° ANIMACIONES */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .slide-in {
            animation: slideIn 0.3s ease forwards;
        }
    </style>
</head>
<body>
    <!-- üåô TOGGLE DE TEMA -->
    <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">
        <i class="fas fa-moon" id="theme-icon"></i>
    </button>

    <!-- üè† BOT√ìN HOME -->
    <a href="index.html" class="home-button" title="Inicio">
        <i class="fas fa-home"></i>
    </a>

    <!-- üé™ DASHBOARD SUPERIOR FIJO -->
    <div class="dashboard-fixed">
        <div class="dashboard-content">
            <div class="dashboard-grid">
                <div class="dashboard-item">
                    <i class="fas fa-lungs"></i>
                    <div>Examen</div>
                    <div id="exam-progress">0%</div>
                </div>
                <div class="dashboard-item">
                    <i class="fas fa-clipboard-list"></i>
                    <div>Secciones</div>
                    <div id="sections-completed">0/7</div>
                </div>
                <div class="dashboard-item dashboard-alert" id="alerts-item">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>Alertas</div>
                    <div id="alert-count">0</div>
                </div>
                <div class="dashboard-item dashboard-warning" id="warnings-item">
                    <i class="fas fa-exclamation-circle"></i>
                    <div>Avisos</div>
                    <div id="warning-count">0</div>
                </div>
                <div class="dashboard-item dashboard-normal" id="findings-item">
                    <i class="fas fa-search"></i>
                    <div>Hallazgos</div>
                    <div id="findings-count">0</div>
                </div>
                <div class="dashboard-item">
                    <i class="fas fa-heartbeat"></i>
                    <div>Completitud</div>
                    <div id="completeness-status">0%</div>
                </div>
            </div>
            <div class="control-bar">
                <button class="control-btn btn-primary" onclick="toggleNavPanel()">
                    <i class="fas fa-bars"></i> Navegaci√≥n
                </button>
                <button class="control-btn btn-primary" onclick="toggleStickyPanel()" id="sticky-toggle-btn">
                    <i class="fas fa-columns"></i> Vista Dividida
                </button>
                <button class="control-btn btn-success" onclick="generateConclusion()">
                    <i class="fas fa-file-medical"></i> Generar
                </button>
                <button class="control-btn btn-warning" onclick="expandAllSections()">
                    <i class="fas fa-expand-alt"></i> Expandir
                </button>
                <button class="control-btn btn-success" onclick="autoPopulateCommon()">
                    <i class="fas fa-magic"></i> Auto-rellenar
                </button>
                <button class="control-btn btn-danger" onclick="clearForm()">
                    <i class="fas fa-trash"></i> Limpiar
                </button>
            </div>
        </div>
    </div>

    <!-- üéØ PANEL LATERAL DE NAVEGACI√ìN -->
    <div class="nav-panel" id="nav-panel">
        <h3><i class="fas fa-map"></i> Navegaci√≥n R√°pida</h3>
        <div class="nav-item" onclick="scrollToSection('anamnesis')">
            <i class="fas fa-user-edit"></i>
            <span>Anamnesis</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-anamnesis"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('thoracic-inspection')">
            <i class="fas fa-eye"></i>
            <span>Inspecci√≥n Tor√°cica</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-thoracic-inspection"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('thoracic-palpation')">
            <i class="fas fa-hands"></i>
            <span>Palpaci√≥n Tor√°cica</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-thoracic-palpation"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('thoracic-percussion')">
            <i class="fas fa-hand-paper"></i>
            <span>Percusi√≥n Tor√°cica</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-thoracic-percussion"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('pulmonary-auscultation')">
            <i class="fas fa-stethoscope"></i>
            <span>Auscultaci√≥n Pulmonar</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-pulmonary-auscultation"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('respiratory-scales')">
            <i class="fas fa-chart-line"></i>
            <span>Escalas de Evaluaci√≥n</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-respiratory-scales"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('spirometry')">
            <i class="fas fa-tachometer-alt"></i>
            <span>Espirometr√≠a</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-spirometry"></i>
        </div>
    </div>

    <!-- üìä PANEL LATERAL STICKY - FUNCIONALIDAD PRINCIPAL -->
    <div class="sticky-panel" id="stickyConclusion">
        <div class="sticky-header">
            <span><i class="fas fa-file-medical-alt"></i> Informe en Tiempo Real</span>
            <div class="sticky-controls">
                <button class="sticky-btn" onclick="copyStickyToClipboard()" title="Copiar informe">
                    <i class="fas fa-copy"></i>
                </button>
                <button class="sticky-btn" onclick="printStickyConclusion()" title="Imprimir informe">
                    <i class="fas fa-print"></i>
                </button>
                <button class="sticky-btn" onclick="generateStickyConclusion()" title="Actualizar informe">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="sticky-content" id="stickyContent">
            Seleccione los par√°metros del examen para generar el informe en tiempo real...
        </div>
        <div class="update-indicator" id="updateIndicator">
            <div class="spinner"></div>
            <span>Actualizando informe...</span>
        </div>
    </div>

    <!-- Notificaci√≥n de copia -->
    <div class="copy-notification" id="copyNotification">
        <i class="fas fa-check-circle"></i>
        <span>¬°Informe copiado al portapapeles!</span>
    </div>

    <div class="main-container">
        <h1><i class="fas fa-lungs"></i> Examen Neumol√≥gico - Algoritmo de Evaluaci√≥n Avanzado</h1>
        
        <!-- Anamnesis y Quejas -->
        <div class="section" id="section-anamnesis">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-user-edit"></i> Anamnesis y Quejas Principales</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-anamnesis">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="anamnesis">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-clipboard-list"></i> Quejas Respiratorias Principales</div>
                    <div class="checkbox-grid">
                        <div class="checkbox-item"><input type="checkbox" id="disnea"><label for="disnea">Disnea</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="tos"><label for="tos">Tos</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="expectoracion"><label for="expectoracion">Expectoraci√≥n</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="dolor-toracico"><label for="dolor-toracico">Dolor tor√°cico</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="hemoptisis"><label for="hemoptisis">Hemoptisis</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="sibilancias"><label for="sibilancias">Sibilancias</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ortopnea"><label for="ortopnea">Ortopnea</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="disnea-paroxistica"><label for="disnea-paroxistica">Disnea parox√≠stica nocturna</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="cianosis"><label for="cianosis">Cianosis</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ronquidos"><label for="ronquidos">Ronquidos</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="apneas"><label for="apneas">Pausas respiratorias</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="fiebre"><label for="fiebre">Fiebre</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="sudoracion-nocturna"><label for="sudoracion-nocturna">Sudoraci√≥n nocturna</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="perdida-peso"><label for="perdida-peso">P√©rdida de peso</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="sin-quejas-neumo" onchange="handleNoComplaints()"><label for="sin-quejas-neumo">Sin quejas</label></div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-wind"></i> Evaluaci√≥n de la Disnea</div>
                    <div class="dyspnea-assessment">
                        <h4>Escala mMRC (Modified Medical Research Council)</h4>
                        <div class="severity-grid">
                            <div class="severity-item"><input type="radio" name="mmrc-dyspnea" id="mmrc-0" value="0"><label for="mmrc-0">Grado 0: Solo con ejercicio intenso</label></div>
                            <div class="severity-item"><input type="radio" name="mmrc-dyspnea" id="mmrc-1" value="1"><label for="mmrc-1">Grado 1: Al caminar r√°pido o cuesta arriba</label></div>
                            <div class="severity-item"><input type="radio" name="mmrc-dyspnea" id="mmrc-2" value="2"><label for="mmrc-2">Grado 2: Camina m√°s lento que personas de su edad</label></div>
                            <div class="severity-item"><input type="radio" name="mmrc-dyspnea" id="mmrc-3" value="3"><label for="mmrc-3">Grado 3: Se detiene al caminar ~100m o pocos minutos</label></div>
                            <div class="severity-item"><input type="radio" name="mmrc-dyspnea" id="mmrc-4" value="4"><label for="mmrc-4">Grado 4: Demasiada disnea para salir de casa</label></div>
                        </div>
                        <div class="measurement">
                            <label>Tiempo de evoluci√≥n:</label>
                            <input type="number" class="input-field" id="disnea-tiempo" min="0" max="120">
                            <select id="disnea-unidad">
                                <option value="d√≠as">d√≠as</option>
                                <option value="semanas">semanas</option>
                                <option value="meses">meses</option>
                                <option value="a√±os">a√±os</option>
                            </select>
                        </div>
                    </div>

                    <div class="exam-section">
                        <h4>Caracter√≠sticas de la Disnea</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="radio" name="tipo-disnea" id="disnea-reposo"><label for="disnea-reposo">En reposo</label></div>
                            <div class="checkbox-item"><input type="radio" name="tipo-disnea" id="disnea-esfuerzo"><label for="disnea-esfuerzo">De esfuerzo</label></div>
                            <div class="checkbox-item"><input type="radio" name="tipo-disnea" id="disnea-mixta"><label for="disnea-mixta">Mixta</label></div>
                        </div>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="disnea-progresiva"><label for="disnea-progresiva">Progresiva</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="disnea-episodica"><label for="disnea-episodica">Epis√≥dica</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="disnea-nocturna"><label for="disnea-nocturna">Nocturna</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-volume-up"></i> Evaluaci√≥n de la Tos</div>
                    <div class="cough-assessment">
                        <h4>Caracter√≠sticas de la Tos</h4>
                        <div class="measurement">
                            <label>Duraci√≥n de la tos:</label>
                            <input type="number" class="input-field" id="tos-duracion" min="0" max="24">
                            <select id="tos-duracion-unidad">
                                <option value="d√≠as">d√≠as</option>
                                <option value="semanas">semanas</option>
                                <option value="meses">meses</option>
                            </select>
                        </div>
                        <div class="severity-grid">
                            <div class="severity-item"><input type="radio" name="tipo-tos" id="tos-seca"><label for="tos-seca">Tos seca</label></div>
                            <div class="severity-item"><input type="radio" name="tipo-tos" id="tos-productiva"><label for="tos-productiva">Tos productiva</label></div>
                        </div>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="tos-matutina"><label for="tos-matutina">Predominio matutino</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="tos-nocturna"><label for="tos-nocturna">Predominio nocturno</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="tos-persistente"><label for="tos-persistente">Persistente</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="tos-paroxistica"><label for="tos-paroxistica">Parox√≠stica</label></div>
                        </div>
                    </div>

                    <div class="exam-section">
                        <h4>Caracter√≠sticas de la Expectoraci√≥n</h4>
                        <div class="measurement">
                            <label>Volumen diario (ml):</label>
                            <input type="number" class="input-field" id="expectoracion-volumen" min="0" max="500">
                            <span>ml/d√≠a</span>
                        </div>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="radio" name="color-expectoracion" id="expectoracion-blanca"><label for="expectoracion-blanca">Blanca/mucosa</label></div>
                            <div class="checkbox-item"><input type="radio" name="color-expectoracion" id="expectoracion-amarilla"><label for="expectoracion-amarilla">Amarilla</label></div>
                            <div class="checkbox-item"><input type="radio" name="color-expectoracion" id="expectoracion-verde"><label for="expectoracion-verde">Verde/purulenta</label></div>
                            <div class="checkbox-item"><input type="radio" name="color-expectoracion" id="expectoracion-herrumbrosa"><label for="expectoracion-herrumbrosa">Herrumbrosa</label></div>
                            <div class="checkbox-item"><input type="radio" name="color-expectoracion" id="expectoracion-rosada"><label for="expectoracion-rosada">Rosada/espumosa</label></div>
                        </div>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="expectoracion-mal-olor"><label for="expectoracion-mal-olor">Mal olor</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="expectoracion-sangre"><label for="expectoracion-sangre">Con sangre</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-smoking"></i> Factores de Riesgo y Antecedentes</div>
                    <div class="exam-section">
                        <h4>H√°bito Tab√°quico</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="radio" name="tabaquismo" id="no-fumador"><label for="no-fumador">No fumador</label></div>
                            <div class="checkbox-item"><input type="radio" name="tabaquismo" id="ex-fumador"><label for="ex-fumador">Ex fumador</label></div>
                            <div class="checkbox-item"><input type="radio" name="tabaquismo" id="fumador-activo"><label for="fumador-activo">Fumador activo</label></div>
                        </div>
                        <div class="measurement">
                            <label>Paquetes/a√±o:</label>
                            <input type="number" class="input-field" id="paquetes-ano" min="0" max="200" onchange="calculatePackYears()">
                            <span>paq/a√±o</span>
                        </div>
                        <div class="measurement">
                            <label>Cigarrillos/d√≠a:</label>
                            <input type="number" class="input-field" id="cigarrillos-dia" min="0" max="60" onchange="calculatePackYears()">
                        </div>
                        <div class="measurement">
                            <label>A√±os fumando:</label>
                            <input type="number" class="input-field" id="anos-fumando" min="0" max="80" onchange="calculatePackYears()">
                        </div>
                        <div class="score-item">
                            <span>Paquetes/a√±o calculados:</span>
                            <span class="score-value" id="paquetes-calculados">0</span>
                        </div>
                    </div>

                    <div class="exam-section">
                        <h4>Exposiciones Ocupacionales</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="asbesto"><label for="asbesto">Asbesto</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="silice"><label for="silice">S√≠lice</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="carbon"><label for="carbon">Carb√≥n</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="polvos-organicos"><label for="polvos-organicos">Polvos org√°nicos</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="vapores-quimicos"><label for="vapores-quimicos">Vapores qu√≠micos</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="soldadura"><label for="soldadura">Soldadura</label></div>
                        </div>
                    </div>

                    <div class="exam-section">
                        <h4>Antecedentes Patol√≥gicos</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="asma"><label for="asma">Asma</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="epoc"><label for="epoc">EPOC</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="neumonia-previa"><label for="neumonia-previa">Neumon√≠a previa</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="tuberculosis"><label for="tuberculosis">Tuberculosis</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="neumotorax"><label for="neumotorax">Neumot√≥rax</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="tromboembolismo"><label for="tromboembolismo">Tromboembolismo pulmonar</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="cancer-pulmon"><label for="cancer-pulmon">C√°ncer de pulm√≥n</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="fibrosis-pulmonar"><label for="fibrosis-pulmonar">Fibrosis pulmonar</label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Inspecci√≥n Tor√°cica -->
        <div class="section" id="section-thoracic-inspection">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-eye"></i> Inspecci√≥n Tor√°cica</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-thoracic-inspection">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="thoracic-inspection">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color respiratory-color"></div>
                        <span>Evaluaci√≥n Respiratoria</span>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-user-check"></i> Configuraci√≥n Tor√°cica</div>
                    <div class="exam-section">
                        <h4>Forma del T√≥rax</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="radio" name="forma-torax" id="torax-normal"><label for="torax-normal">Normal</label></div>
                            <div class="checkbox-item"><input type="radio" name="forma-torax" id="torax-en-tonel"><label for="torax-en-tonel">En tonel (EPOC)</label></div>
                            <div class="checkbox-item"><input type="radio" name="forma-torax" id="torax-embudo"><label for="torax-embudo">Pectus excavatum (embudo)</label></div>
                            <div class="checkbox-item"><input type="radio" name="forma-torax" id="torax-paloma"><label for="torax-paloma">Pectus carinatum (paloma)</label></div>
                            <div class="checkbox-item"><input type="radio" name="forma-torax" id="torax-cifoescoliotico"><label for="torax-cifoescoliotico">Cifoescoli√≥tico</label></div>
                        </div>
                    </div>

                    <div class="exam-section">
                        <h4>Simetr√≠a y Deformidades</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="torax-simetrico"><label for="torax-simetrico">Sim√©trico</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="torax-asimetrico"><label for="torax-asimetrico">Asim√©trico</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="abombamiento"><label for="abombamiento">Abombamiento</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="retracciones"><label for="retracciones">Retracciones</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="cicatrices"><label for="cicatrices">Cicatrices</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="masas-visibles"><label for="masas-visibles">Masas visibles</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-heartbeat"></i> Patr√≥n Respiratorio</div>
                    <div class="respiratory-assessment">
                        <h4>Caracter√≠sticas de la Respiraci√≥n</h4>
                        <div class="measurement">
                            <label>Frecuencia respiratoria:</label>
                            <input type="number" class="input-field" id="frecuencia-respiratoria" min="5" max="60" onchange="evaluateRespiratoryRate()">
                            <span>rpm</span>
                        </div>
                        <div class="score-item">
                            <span>Interpretaci√≥n FR:</span>
                            <span class="score-value" id="interpretacion-fr">--</span>
                        </div>
                        
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="radio" name="patron-respiratorio" id="respiracion-normal"><label for="respiracion-normal">Eupnea (normal)</label></div>
                            <div class="checkbox-item"><input type="radio" name="patron-respiratorio" id="taquipnea"><label for="taquipnea">Taquipnea</label></div>
                            <div class="checkbox-item"><input type="radio" name="patron-respiratorio" id="bradipnea"><label for="bradipnea">Bradipnea</label></div>
                            <div class="checkbox-item"><input type="radio" name="patron-respiratorio" id="respiracion-kussmaul"><label for="respiracion-kussmaul">Kussmaul</label></div>
                            <div class="checkbox-item"><input type="radio" name="patron-respiratorio" id="respiracion-cheyne-stokes"><label for="respiracion-cheyne-stokes">Cheyne-Stokes</label></div>
                            <div class="checkbox-item"><input type="radio" name="patron-respiratorio" id="respiracion-biot"><label for="respiracion-biot">Biot</label></div>
                        </div>
                        
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="uso-musculos-accesorios"><label for="uso-musculos-accesorios">Uso de m√∫sculos accesorios</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="tiraje-intercostal"><label for="tiraje-intercostal">Tiraje intercostal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="tiraje-subcostal"><label for="tiraje-subcostal">Tiraje subcostal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="aleteo-nasal"><label for="aleteo-nasal">Aleteo nasal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="respiracion-paradojica"><label for="respiracion-paradojica">Respiraci√≥n parad√≥jica</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-lungs"></i> Signos de Insuficiencia Respiratoria</div>
                    <div class="saturation-assessment">
                        <h4>Oximetr√≠a y Signos de Hipoxemia</h4>
                        <div class="measurement">
                            <label>Saturaci√≥n O2 (%):</label>
                            <input type="number" class="input-field" id="saturacion-o2" min="70" max="100" onchange="evaluateSaturation()">
                            <span>%</span>
                        </div>
                        <div class="measurement">
                            <label>FiO2:</label>
                            <input type="number" class="input-field" id="fio2" min="21" max="100" step="1">
                            <span>%</span>
                        </div>
                        <div class="score-item">
                            <span>Interpretaci√≥n SatO2:</span>
                            <span class="score-value" id="interpretacion-sat">--</span>
                        </div>
                        
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="cianosis-central"><label for="cianosis-central">Cianosis central</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="cianosis-periferica"><label for="cianosis-periferica">Cianosis perif√©rica</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="acropaquias"><label for="acropaquias">Acropaquias (dedos en palillo de tambor)</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="confusion"><label for="confusion">Confusi√≥n/agitaci√≥n</label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Palpaci√≥n Tor√°cica -->
        <div class="section" id="section-thoracic-palpation">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-hands"></i> Palpaci√≥n Tor√°cica</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-thoracic-palpation">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="thoracic-palpation">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-expand-arrows-alt"></i> Expansibilidad Tor√°cica</div>
                    <div class="bilateral-container">
                        <div class="side-container">
                            <div class="side-header">Evaluaci√≥n Bilateral</div>
                            <div class="test-results">
                                <div class="test-item">
                                    <label>Expansibilidad sim√©trica</label>
                                    <div class="test-controls">
                                        <div class="test-checkbox"><input type="checkbox" id="expansibilidad-normal" onchange="handleMutuallyExclusive('expansibilidad-normal', 'expansibilidad-asimetrica', this)"><span class="negative">Normal</span></div>
                                        <div class="test-checkbox"><input type="checkbox" id="expansibilidad-asimetrica" onchange="handleMutuallyExclusive('expansibilidad-normal', 'expansibilidad-asimetrica', this)"><span class="positive">Asim√©trica</span></div>
                                    </div>
                                </div>
                                <div class="test-item">
                                    <label>Amplitud de expansi√≥n</label>
                                    <div class="test-controls">
                                        <div class="test-checkbox"><input type="checkbox" id="amplitud-normal" onchange="handleMutuallyExclusive('amplitud-normal', 'amplitud-disminuida', this)"><span class="negative">Normal</span></div>
                                        <div class="test-checkbox"><input type="checkbox" id="amplitud-disminuida" onchange="handleMutuallyExclusive('amplitud-normal', 'amplitud-disminuida', this)"><span class="positive">Disminuida</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="side-container">
                            <div class="side-header">Mediciones</div>
                            <div class="measurement">
                                <label>Expansi√≥n tor√°cica:</label>
                                <input type="number" class="input-field" id="expansion-toracica" min="0" max="15" step="0.5">
                                <span>cm (normal >5cm)</span>
                            </div>
                            <div class="measurement">
                                <label>Per√≠metro inspiratorio:</label>
                                <input type="number" class="input-field" id="perimetro-inspiratorio" min="60" max="150">
                                <span>cm</span>
                            </div>
                            <div class="measurement">
                                <label>Per√≠metro espiratorio:</label>
                                <input type="number" class="input-field" id="perimetro-espiratorio" min="60" max="150">
                                <span>cm</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-wave-square"></i> Fr√©mito Vocal</div>
                    <div class="lung-map">
                        <div class="lung-side">
                            <h5>Pulm√≥n Derecho</h5>
                            <div class="lung-zone">
                                <h6>√Åpice</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-apice" id="fremito-der-apice-normal" value="normal"><span class="negative">Normal</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-apice" id="fremito-der-apice-aumentado" value="aumentado"><span class="positive">Aumentado</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-apice" id="fremito-der-apice-disminuido" value="disminuido"><span class="abnormal">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-apice" id="fremito-der-apice-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Superior</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-superior" id="fremito-der-superior-normal" value="normal"><span class="negative">Normal</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-superior" id="fremito-der-superior-aumentado" value="aumentado"><span class="positive">Aumentado</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-superior" id="fremito-der-superior-disminuido" value="disminuido"><span class="abnormal">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-superior" id="fremito-der-superior-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Medio</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-medio" id="fremito-der-medio-normal" value="normal"><span class="negative">Normal</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-medio" id="fremito-der-medio-aumentado" value="aumentado"><span class="positive">Aumentado</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-medio" id="fremito-der-medio-disminuido" value="disminuido"><span class="abnormal">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-medio" id="fremito-der-medio-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Inferior</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-inferior" id="fremito-der-inferior-normal" value="normal"><span class="negative">Normal</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-inferior" id="fremito-der-inferior-aumentado" value="aumentado"><span class="positive">Aumentado</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-inferior" id="fremito-der-inferior-disminuido" value="disminuido"><span class="abnormal">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-der-inferior" id="fremito-der-inferior-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lung-side">
                            <h5>Pulm√≥n Izquierdo</h5>
                            <div class="lung-zone">
                                <h6>√Åpice</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-apice" id="fremito-izq-apice-normal" value="normal"><span class="negative">Normal</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-apice" id="fremito-izq-apice-aumentado" value="aumentado"><span class="positive">Aumentado</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-apice" id="fremito-izq-apice-disminuido" value="disminuido"><span class="abnormal">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-apice" id="fremito-izq-apice-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Superior</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-superior" id="fremito-izq-superior-normal" value="normal"><span class="negative">Normal</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-superior" id="fremito-izq-superior-aumentado" value="aumentado"><span class="positive">Aumentado</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-superior" id="fremito-izq-superior-disminuido" value="disminuido"><span class="abnormal">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-superior" id="fremito-izq-superior-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Medio</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-medio" id="fremito-izq-medio-normal" value="normal"><span class="negative">Normal</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-medio" id="fremito-izq-medio-aumentado" value="aumentado"><span class="positive">Aumentado</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-medio" id="fremito-izq-medio-disminuido" value="disminuido"><span class="abnormal">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-medio" id="fremito-izq-medio-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Inferior</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-inferior" id="fremito-izq-inferior-normal" value="normal"><span class="negative">Normal</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-inferior" id="fremito-izq-inferior-aumentado" value="aumentado"><span class="positive">Aumentado</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-inferior" id="fremito-izq-inferior-disminuido" value="disminuido"><span class="abnormal">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="fremito-izq-inferior" id="fremito-izq-inferior-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Percusi√≥n Tor√°cica -->
        <div class="section" id="section-thoracic-percussion">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-hand-paper"></i> Percusi√≥n Tor√°cica</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-thoracic-percussion">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="thoracic-percussion">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-drum"></i> Sonoridad Pulmonar</div>
                    <div class="lung-map">
                        <div class="lung-side">
                            <h5>Pulm√≥n Derecho</h5>
                            <div class="lung-zone">
                                <h6>√Åpice</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-apice" id="percusion-der-apice-sonoro" value="sonoro"><span class="negative">Sonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-apice" id="percusion-der-apice-hipersonoro" value="hipersonoro"><span class="abnormal">Hipersonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-apice" id="percusion-der-apice-mate" value="mate"><span class="positive">Mate</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-apice" id="percusion-der-apice-submate" value="submate"><span class="positive">Submate</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Superior</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-superior" id="percusion-der-superior-sonoro" value="sonoro"><span class="negative">Sonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-superior" id="percusion-der-superior-hipersonoro" value="hipersonoro"><span class="abnormal">Hipersonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-superior" id="percusion-der-superior-mate" value="mate"><span class="positive">Mate</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-superior" id="percusion-der-superior-submate" value="submate"><span class="positive">Submate</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Medio</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-medio" id="percusion-der-medio-sonoro" value="sonoro"><span class="negative">Sonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-medio" id="percusion-der-medio-hipersonoro" value="hipersonoro"><span class="abnormal">Hipersonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-medio" id="percusion-der-medio-mate" value="mate"><span class="positive">Mate</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-medio" id="percusion-der-medio-submate" value="submate"><span class="positive">Submate</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Inferior</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-inferior" id="percusion-der-inferior-sonoro" value="sonoro"><span class="negative">Sonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-inferior" id="percusion-der-inferior-hipersonoro" value="hipersonoro"><span class="abnormal">Hipersonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-inferior" id="percusion-der-inferior-mate" value="mate"><span class="positive">Mate</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-der-inferior" id="percusion-der-inferior-submate" value="submate"><span class="positive">Submate</span></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lung-side">
                            <h5>Pulm√≥n Izquierdo</h5>
                            <div class="lung-zone">
                                <h6>√Åpice</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-apice" id="percusion-izq-apice-sonoro" value="sonoro"><span class="negative">Sonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-apice" id="percusion-izq-apice-hipersonoro" value="hipersonoro"><span class="abnormal">Hipersonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-apice" id="percusion-izq-apice-mate" value="mate"><span class="positive">Mate</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-apice" id="percusion-izq-apice-submate" value="submate"><span class="positive">Submate</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Superior</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-superior" id="percusion-izq-superior-sonoro" value="sonoro"><span class="negative">Sonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-superior" id="percusion-izq-superior-hipersonoro" value="hipersonoro"><span class="abnormal">Hipersonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-superior" id="percusion-izq-superior-mate" value="mate"><span class="positive">Mate</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-superior" id="percusion-izq-superior-submate" value="submate"><span class="positive">Submate</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Medio</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-medio" id="percusion-izq-medio-sonoro" value="sonoro"><span class="negative">Sonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-medio" id="percusion-izq-medio-hipersonoro" value="hipersonoro"><span class="abnormal">Hipersonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-medio" id="percusion-izq-medio-mate" value="mate"><span class="positive">Mate</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-medio" id="percusion-izq-medio-submate" value="submate"><span class="positive">Submate</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Inferior</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-inferior" id="percusion-izq-inferior-sonoro" value="sonoro"><span class="negative">Sonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-inferior" id="percusion-izq-inferior-hipersonoro" value="hipersonoro"><span class="abnormal">Hipersonoro</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-inferior" id="percusion-izq-inferior-mate" value="mate"><span class="positive">Mate</span></div>
                                    <div class="test-checkbox"><input type="radio" name="percusion-izq-inferior" id="percusion-izq-inferior-submate" value="submate"><span class="positive">Submate</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-arrows-alt-v"></i> Excursi√≥n Diafragm√°tica</div>
                    <div class="bilateral-container">
                        <div class="side-container">
                            <div class="side-header">Hemidiafragma Derecho</div>
                            <div class="measurement">
                                <label>Excursi√≥n:</label>
                                <input type="number" class="input-field" id="excursion-der" min="0" max="15" step="0.5">
                                <span>cm (normal 3-5cm)</span>
                            </div>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="diafragma-der-normal"><span class="negative">Normal</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="diafragma-der-elevado"><span class="positive">Elevado</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="diafragma-der-bajo"><span class="abnormal">Bajo</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="diafragma-der-paralitico"><span class="positive">Paral√≠tico</span></div>
                            </div>
                        </div>
                        
                        <div class="side-container">
                            <div class="side-header">Hemidiafragma Izquierdo</div>
                            <div class="measurement">
                                <label>Excursi√≥n:</label>
                                <input type="number" class="input-field" id="excursion-izq" min="0" max="15" step="0.5">
                                <span>cm (normal 3-5cm)</span>
                            </div>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="diafragma-izq-normal"><span class="negative">Normal</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="diafragma-izq-elevado"><span class="positive">Elevado</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="diafragma-izq-bajo"><span class="abnormal">Bajo</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="diafragma-izq-paralitico"><span class="positive">Paral√≠tico</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Auscultaci√≥n Pulmonar -->
        <div class="section" id="section-pulmonary-auscultation">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-stethoscope"></i> Auscultaci√≥n Pulmonar</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-pulmonary-auscultation">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="pulmonary-auscultation">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-volume-up"></i> Ruidos Respiratorios Normales</div>
                    <div class="lung-map">
                        <div class="lung-side">
                            <h5>Pulm√≥n Derecho</h5>
                            <div class="lung-zone">
                                <h6>√Åpice</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-apice" id="ruidos-der-apice-vesicular" value="vesicular"><span class="negative">Vesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-apice" id="ruidos-der-apice-bronquial" value="bronquial"><span class="positive">Bronquial</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-apice" id="ruidos-der-apice-broncovesicular" value="broncovesicular"><span class="abnormal">Broncovesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-apice" id="ruidos-der-apice-disminuido" value="disminuido"><span class="positive">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-apice" id="ruidos-der-apice-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Superior</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-superior" id="ruidos-der-superior-vesicular" value="vesicular"><span class="negative">Vesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-superior" id="ruidos-der-superior-bronquial" value="bronquial"><span class="positive">Bronquial</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-superior" id="ruidos-der-superior-broncovesicular" value="broncovesicular"><span class="abnormal">Broncovesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-superior" id="ruidos-der-superior-disminuido" value="disminuido"><span class="positive">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-superior" id="ruidos-der-superior-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Medio</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-medio" id="ruidos-der-medio-vesicular" value="vesicular"><span class="negative">Vesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-medio" id="ruidos-der-medio-bronquial" value="bronquial"><span class="positive">Bronquial</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-medio" id="ruidos-der-medio-broncovesicular" value="broncovesicular"><span class="abnormal">Broncovesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-medio" id="ruidos-der-medio-disminuido" value="disminuido"><span class="positive">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-medio" id="ruidos-der-medio-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Inferior</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-inferior" id="ruidos-der-inferior-vesicular" value="vesicular"><span class="negative">Vesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-inferior" id="ruidos-der-inferior-bronquial" value="bronquial"><span class="positive">Bronquial</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-inferior" id="ruidos-der-inferior-broncovesicular" value="broncovesicular"><span class="abnormal">Broncovesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-inferior" id="ruidos-der-inferior-disminuido" value="disminuido"><span class="positive">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-der-inferior" id="ruidos-der-inferior-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lung-side">
                            <h5>Pulm√≥n Izquierdo</h5>
                            <div class="lung-zone">
                                <h6>√Åpice</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-apice" id="ruidos-izq-apice-vesicular" value="vesicular"><span class="negative">Vesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-apice" id="ruidos-izq-apice-bronquial" value="bronquial"><span class="positive">Bronquial</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-apice" id="ruidos-izq-apice-broncovesicular" value="broncovesicular"><span class="abnormal">Broncovesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-apice" id="ruidos-izq-apice-disminuido" value="disminuido"><span class="positive">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-apice" id="ruidos-izq-apice-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Superior</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-superior" id="ruidos-izq-superior-vesicular" value="vesicular"><span class="negative">Vesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-superior" id="ruidos-izq-superior-bronquial" value="bronquial"><span class="positive">Bronquial</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-superior" id="ruidos-izq-superior-broncovesicular" value="broncovesicular"><span class="abnormal">Broncovesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-superior" id="ruidos-izq-superior-disminuido" value="disminuido"><span class="positive">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-superior" id="ruidos-izq-superior-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Medio</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-medio" id="ruidos-izq-medio-vesicular" value="vesicular"><span class="negative">Vesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-medio" id="ruidos-izq-medio-bronquial" value="bronquial"><span class="positive">Bronquial</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-medio" id="ruidos-izq-medio-broncovesicular" value="broncovesicular"><span class="abnormal">Broncovesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-medio" id="ruidos-izq-medio-disminuido" value="disminuido"><span class="positive">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-medio" id="ruidos-izq-medio-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Inferior</h6>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-inferior" id="ruidos-izq-inferior-vesicular" value="vesicular"><span class="negative">Vesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-inferior" id="ruidos-izq-inferior-bronquial" value="bronquial"><span class="positive">Bronquial</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-inferior" id="ruidos-izq-inferior-broncovesicular" value="broncovesicular"><span class="abnormal">Broncovesicular</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-inferior" id="ruidos-izq-inferior-disminuido" value="disminuido"><span class="positive">Disminuido</span></div>
                                    <div class="test-checkbox"><input type="radio" name="ruidos-izq-inferior" id="ruidos-izq-inferior-abolido" value="abolido"><span class="positive">Abolido</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-exclamation-triangle"></i> Ruidos Adventicios</div>
                    <div class="lung-map">
                        <div class="lung-side">
                            <h5>Pulm√≥n Derecho</h5>
                            <div class="lung-zone">
                                <h6>√Åpice</h6>
                                <div class="lung-findings">
                                    <label><input type="checkbox" id="crepitantes-der-apice">Crepitantes</label>
                                    <label><input type="checkbox" id="subcrepitantes-der-apice">Subcrepitantes</label>
                                    <label><input type="checkbox" id="sibilancias-der-apice">Sibilancias</label>
                                    <label><input type="checkbox" id="roncus-der-apice">Roncus</label>
                                    <label><input type="checkbox" id="estridor-der-apice">Estridor</label>
                                    <label><input type="checkbox" id="roce-der-apice">Roce pleural</label>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Superior</h6>
                                <div class="lung-findings">
                                    <label><input type="checkbox" id="crepitantes-der-superior">Crepitantes</label>
                                    <label><input type="checkbox" id="subcrepitantes-der-superior">Subcrepitantes</label>
                                    <label><input type="checkbox" id="sibilancias-der-superior">Sibilancias</label>
                                    <label><input type="checkbox" id="roncus-der-superior">Roncus</label>
                                    <label><input type="checkbox" id="estridor-der-superior">Estridor</label>
                                    <label><input type="checkbox" id="roce-der-superior">Roce pleural</label>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Medio</h6>
                                <div class="lung-findings">
                                    <label><input type="checkbox" id="crepitantes-der-medio">Crepitantes</label>
                                    <label><input type="checkbox" id="subcrepitantes-der-medio">Subcrepitantes</label>
                                    <label><input type="checkbox" id="sibilancias-der-medio">Sibilancias</label>
                                    <label><input type="checkbox" id="roncus-der-medio">Roncus</label>
                                    <label><input type="checkbox" id="estridor-der-medio">Estridor</label>
                                    <label><input type="checkbox" id="roce-der-medio">Roce pleural</label>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Inferior</h6>
                                <div class="lung-findings">
                                    <label><input type="checkbox" id="crepitantes-der-inferior">Crepitantes</label>
                                    <label><input type="checkbox" id="subcrepitantes-der-inferior">Subcrepitantes</label>
                                    <label><input type="checkbox" id="sibilancias-der-inferior">Sibilancias</label>
                                    <label><input type="checkbox" id="roncus-der-inferior">Roncus</label>
                                    <label><input type="checkbox" id="estridor-der-inferior">Estridor</label>
                                    <label><input type="checkbox" id="roce-der-inferior">Roce pleural</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lung-side">
                            <h5>Pulm√≥n Izquierdo</h5>
                            <div class="lung-zone">
                                <h6>√Åpice</h6>
                                <div class="lung-findings">
                                    <label><input type="checkbox" id="crepitantes-izq-apice">Crepitantes</label>
                                    <label><input type="checkbox" id="subcrepitantes-izq-apice">Subcrepitantes</label>
                                    <label><input type="checkbox" id="sibilancias-izq-apice">Sibilancias</label>
                                    <label><input type="checkbox" id="roncus-izq-apice">Roncus</label>
                                    <label><input type="checkbox" id="estridor-izq-apice">Estridor</label>
                                    <label><input type="checkbox" id="roce-izq-apice">Roce pleural</label>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Superior</h6>
                                <div class="lung-findings">
                                    <label><input type="checkbox" id="crepitantes-izq-superior">Crepitantes</label>
                                    <label><input type="checkbox" id="subcrepitantes-izq-superior">Subcrepitantes</label>
                                    <label><input type="checkbox" id="sibilancias-izq-superior">Sibilancias</label>
                                    <label><input type="checkbox" id="roncus-izq-superior">Roncus</label>
                                    <label><input type="checkbox" id="estridor-izq-superior">Estridor</label>
                                    <label><input type="checkbox" id="roce-izq-superior">Roce pleural</label>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Medio</h6>
                                <div class="lung-findings">
                                    <label><input type="checkbox" id="crepitantes-izq-medio">Crepitantes</label>
                                    <label><input type="checkbox" id="subcrepitantes-izq-medio">Subcrepitantes</label>
                                    <label><input type="checkbox" id="sibilancias-izq-medio">Sibilancias</label>
                                    <label><input type="checkbox" id="roncus-izq-medio">Roncus</label>
                                    <label><input type="checkbox" id="estridor-izq-medio">Estridor</label>
                                    <label><input type="checkbox" id="roce-izq-medio">Roce pleural</label>
                                </div>
                            </div>
                            <div class="lung-zone">
                                <h6>Campo Inferior</h6>
                                <div class="lung-findings">
                                    <label><input type="checkbox" id="crepitantes-izq-inferior">Crepitantes</label>
                                    <label><input type="checkbox" id="subcrepitantes-izq-inferior">Subcrepitantes</label>
                                    <label><input type="checkbox" id="sibilancias-izq-inferior">Sibilancias</label>
                                    <label><input type="checkbox" id="roncus-izq-inferior">Roncus</label>
                                    <label><input type="checkbox" id="estridor-izq-inferior">Estridor</label>
                                    <label><input type="checkbox" id="roce-izq-inferior">Roce pleural</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Escalas de Evaluaci√≥n -->
        <div class="section" id="section-respiratory-scales">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-chart-line"></i> Escalas de Evaluaci√≥n Respiratoria</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-respiratory-scales">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="respiratory-scales">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-calculator"></i> Escala CAT (COPD Assessment Test)</div>
                    <div class="score-calculation">
                        <h4>Evaluaci√≥n de Impacto de la EPOC</h4>
                        <div class="exam-section">
                            <h4>Tos</h4>
                            <div class="measurement">
                                <label>Nunca toso (0) ‚Üê ‚Üí Toso todo el tiempo (5):</label>
                                <input type="range" id="cat-tos" min="0" max="5" value="0" oninput="updateCATValue('tos', this.value)">
                                <span id="cat-tos-value">0</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Flemas/secreciones</h4>
                            <div class="measurement">
                                <label>No tengo flemas (0) ‚Üê ‚Üí Pecho lleno de flemas (5):</label>
                                <input type="range" id="cat-flemas" min="0" max="5" value="0" oninput="updateCATValue('flemas', this.value)">
                                <span id="cat-flemas-value">0</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Opresi√≥n en el pecho</h4>
                            <div class="measurement">
                                <label>No siento opresi√≥n (0) ‚Üê ‚Üí Siento mucha opresi√≥n (5):</label>
                                <input type="range" id="cat-opresion" min="0" max="5" value="0" oninput="updateCATValue('opresion', this.value)">
                                <span id="cat-opresion-value">0</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Disnea al subir cuestas/escaleras</h4>
                            <div class="measurement">
                                <label>Sin falta de aire (0) ‚Üê ‚Üí Mucha falta de aire (5):</label>
                                <input type="range" id="cat-disnea" min="0" max="5" value="0" oninput="updateCATValue('disnea', this.value)">
                                <span id="cat-disnea-value">0</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Limitaci√≥n de actividades en casa</h4>
                            <div class="measurement">
                                <label>No limitado (0) ‚Üê ‚Üí Muy limitado (5):</label>
                                <input type="range" id="cat-limitacion" min="0" max="5" value="0" oninput="updateCATValue('limitacion', this.value)">
                                <span id="cat-limitacion-value">0</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Confianza para salir de casa</h4>
                            <div class="measurement">
                                <label>Muy confiado (0) ‚Üê ‚Üí Nada confiado (5):</label>
                                <input type="range" id="cat-confianza" min="0" max="5" value="0" oninput="updateCATValue('confianza', this.value)">
                                <span id="cat-confianza-value">0</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Sue√±o</h4>
                            <div class="measurement">
                                <label>Duermo perfectamente (0) ‚Üê ‚Üí No duermo bien (5):</label>
                                <input type="range" id="cat-sueno" min="0" max="5" value="0" oninput="updateCATValue('sueno', this.value)">
                                <span id="cat-sueno-value">0</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Energ√≠a</h4>
                            <div class="measurement">
                                <label>Lleno de energ√≠a (0) ‚Üê ‚Üí Sin energ√≠a (5):</label>
                                <input type="range" id="cat-energia" min="0" max="5" value="0" oninput="updateCATValue('energia', this.value)">
                                <span id="cat-energia-value">0</span>
                            </div>
                        </div>
                        <div class="score-item">
                            <span>Puntuaci√≥n CAT:</span>
                            <span class="score-value" id="cat-total">0</span>
                            <span>/40 puntos</span>
                        </div>
                        <div class="score-item">
                            <span>Interpretaci√≥n:</span>
                            <span class="score-value" id="cat-interpretation">--</span>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-chart-area"></i> √çndice BODE (EPOC)</div>
                    <div class="score-calculation">
                        <h4>Componentes del √≠ndice BODE</h4>
                        <div class="exam-section">
                            <h4>B - IMC (Body Mass Index)</h4>
                            <div class="measurement">
                                <label>IMC:</label>
                                <input type="number" class="input-field" id="bode-imc" min="10" max="50" step="0.1" onchange="calculateBODE()">
                                <span>kg/m¬≤</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>O - Obstrucci√≥n (FEV1)</h4>
                            <div class="measurement">
                                <label>FEV1 (% predicho):</label>
                                <input type="number" class="input-field" id="bode-fev1" min="0" max="150" onchange="calculateBODE()">
                                <span>%</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>D - Disnea (mMRC)</h4>
                            <div class="severity-grid">
                                <div class="severity-item"><input type="radio" name="bode-disnea" id="bode-disnea-0" value="0" onchange="calculateBODE()"><label for="bode-disnea-0">mMRC 0-1</label></div>
                                <div class="severity-item"><input type="radio" name="bode-disnea" id="bode-disnea-1" value="1" onchange="calculateBODE()"><label for="bode-disnea-1">mMRC 2</label></div>
                                <div class="severity-item"><input type="radio" name="bode-disnea" id="bode-disnea-2" value="2" onchange="calculateBODE()"><label for="bode-disnea-2">mMRC 3</label></div>
                                <div class="severity-item"><input type="radio" name="bode-disnea" id="bode-disnea-3" value="3" onchange="calculateBODE()"><label for="bode-disnea-3">mMRC 4</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>E - Ejercicio (Test marcha 6 min)</h4>
                            <div class="measurement">
                                <label>Distancia caminada:</label>
                                <input type="number" class="input-field" id="bode-ejercicio" min="0" max="800" onchange="calculateBODE()">
                                <span>metros</span>
                            </div>
                        </div>
                        <div class="score-item">
                            <span>Puntuaci√≥n BODE:</span>
                            <span class="score-value" id="bode-total">0</span>
                            <span>/10 puntos</span>
                        </div>
                        <div class="score-item">
                            <span>Supervivencia a 4 a√±os:</span>
                            <span class="score-value" id="bode-prognosis">--</span>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-tachometer-alt"></i> Escala de Borg Modificada</div>
                    <div class="score-calculation">
                        <h4>Intensidad de Disnea durante Ejercicio</h4>
                        <div class="severity-grid">
                            <div class="severity-item"><input type="radio" name="borg-scale" id="borg-0" value="0"><label for="borg-0">0 - Sin disnea</label></div>
                            <div class="severity-item"><input type="radio" name="borg-scale" id="borg-0.5" value="0.5"><label for="borg-0.5">0.5 - Muy, muy leve</label></div>
                            <div class="severity-item"><input type="radio" name="borg-scale" id="borg-1" value="1"><label for="borg-1">1 - Muy leve</label></div>
                            <div class="severity-item"><input type="radio" name="borg-scale" id="borg-2" value="2"><label for="borg-2">2 - Leve</label></div>
                            <div class="severity-item"><input type="radio" name="borg-scale" id="borg-3" value="3"><label for="borg-3">3 - Moderada</label></div>
                            <div class="severity-item"><input type="radio" name="borg-scale" id="borg-4" value="4"><label for="borg-4">4 - Algo severa</label></div>
                            <div class="severity-item"><input type="radio" name="borg-scale" id="borg-5" value="5"><label for="borg-5">5 - Severa</label></div>
                            <div class="severity-item"><input type="radio" name="borg-scale" id="borg-6" value="6"><label for="borg-6">6 - Severa</label></div>
                            <div class="severity-item"><input type="radio" name="borg-scale" id="borg-7" value="7"><label for="borg-7">7 - Muy severa</label></div>
                            <div class="severity-item"><input type="radio" name="borg-scale" id="borg-8" value="8"><label for="borg-8">8 - Muy severa</label></div>
                            <div class="severity-item"><input type="radio" name="borg-scale" id="borg-9" value="9"><label for="borg-9">9 - Muy, muy severa</label></div>
                            <div class="severity-item"><input type="radio" name="borg-scale" id="borg-10" value="10"><label for="borg-10">10 - M√°xima</label></div>
                        </div>
                        <div class="score-item">
                            <span>Puntuaci√≥n Borg:</span>
                            <span class="score-value" id="borg-score">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Espirometr√≠a y Pruebas Funcionales -->
        <div class="section" id="section-spirometry">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-tachometer-alt"></i> Espirometr√≠a y Pruebas Funcionales</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-spirometry">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="spirometry">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-lungs"></i> Vol√∫menes y Capacidades Pulmonares</div>
                    <div class="spirometry-assessment">
                        <h4>Par√°metros Espirom√©tricos</h4>
                        <div class="bilateral-container">
                            <div class="side-container">
                                <div class="side-header">Pre-broncodilatador</div>
                                <div class="measurement">
                                    <label>FVC (L):</label>
                                    <input type="number" class="input-field" id="fvc-pre" min="0" max="8" step="0.01" onchange="calculateSpirometry()">
                                    <span>L</span>
                                </div>
                                <div class="measurement">
                                    <label>FEV1 (L):</label>
                                    <input type="number" class="input-field" id="fev1-pre" min="0" max="6" step="0.01" onchange="calculateSpirometry()">
                                    <span>L</span>
                                </div>
                                <div class="measurement">
                                    <label>FEV1/FVC (%):</label>
                                    <input type="number" class="input-field" id="fev1-fvc-pre" min="20" max="100" onchange="calculateSpirometry()">
                                    <span>%</span>
                                </div>
                                <div class="measurement">
                                    <label>FEF25-75 (L/s):</label>
                                    <input type="number" class="input-field" id="fef25-75-pre" min="0" max="8" step="0.01" onchange="calculateSpirometry()">
                                    <span>L/s</span>
                                </div>
                                <div class="measurement">
                                    <label>PEF (L/min):</label>
                                    <input type="number" class="input-field" id="pef-pre" min="0" max="800" onchange="calculateSpirometry()">
                                    <span>L/min</span>
                                </div>
                            </div>
                            
                            <div class="side-container">
                                <div class="side-header">Post-broncodilatador</div>
                                <div class="measurement">
                                    <label>FVC (L):</label>
                                    <input type="number" class="input-field" id="fvc-post" min="0" max="8" step="0.01" onchange="calculateSpirometry()">
                                    <span>L</span>
                                </div>
                                <div class="measurement">
                                    <label>FEV1 (L):</label>
                                    <input type="number" class="input-field" id="fev1-post" min="0" max="6" step="0.01" onchange="calculateSpirometry()">
                                    <span>L</span>
                                </div>
                                <div class="measurement">
                                    <label>FEV1/FVC (%):</label>
                                    <input type="number" class="input-field" id="fev1-fvc-post" min="20" max="100" onchange="calculateSpirometry()">
                                    <span>%</span>
                                </div>
                                <div class="measurement">
                                    <label>FEF25-75 (L/s):</label>
                                    <input type="number" class="input-field" id="fef25-75-post" min="0" max="8" step="0.01" onchange="calculateSpirometry()">
                                    <span>L/s</span>
                                </div>
                                <div class="measurement">
                                    <label>PEF (L/min):</label>
                                    <input type="number" class="input-field" id="pef-post" min="0" max="800" onchange="calculateSpirometry()">
                                    <span>L/min</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="score-item">
                            <span>Patr√≥n espirom√©trico:</span>
                            <span class="score-value" id="spirometry-pattern">--</span>
                        </div>
                        <div class="score-item">
                            <span>Reversibilidad FEV1:</span>
                            <span class="score-value" id="reversibility-fev1">--</span>
                        </div>
                        <div class="score-item">
                            <span>Reversibilidad FVC:</span>
                            <span class="score-value" id="reversibility-fvc">--</span>
                        </div>
                        <div class="score-item">
                            <span>Interpretaci√≥n:</span>
                            <span class="score-value" id="spirometry-interpretation">--</span>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-medal"></i> Clasificaci√≥n GOLD para EPOC</div>
                    <div class="score-calculation">
                        <h4>Gravedad de Limitaci√≥n del Flujo A√©reo</h4>
                        <div class="measurement">
                            <label>FEV1 post-BD (% predicho):</label>
                            <input type="number" class="input-field" id="gold-fev1" min="0" max="150" onchange="calculateGOLD()">
                            <span>%</span>
                        </div>
                        <div class="score-item">
                            <span>Clasificaci√≥n GOLD:</span>
                            <span class="score-value" id="gold-classification">--</span>
                        </div>
                        <div class="score-item">
                            <span>Gravedad:</span>
                            <span class="score-value" id="gold-severity">--</span>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-walking"></i> Test de Marcha de 6 Minutos</div>
                    <div class="exam-section">
                        <h4>Par√°metros de la Prueba</h4>
                        <div class="measurement">
                            <label>Distancia total:</label>
                            <input type="number" class="input-field" id="marcha-distancia" min="0" max="800" onchange="evaluateWalkTest()">
                            <span>metros</span>
                        </div>
                        <div class="measurement">
                            <label>SpO2 inicial:</label>
                            <input type="number" class="input-field" id="marcha-spo2-inicial" min="70" max="100">
                            <span>%</span>
                        </div>
                        <div class="measurement">
                            <label>SpO2 final:</label>
                            <input type="number" class="input-field" id="marcha-spo2-final" min="70" max="100" onchange="evaluateWalkTest()">
                            <span>%</span>
                        </div>
                        <div class="measurement">
                            <label>FC inicial:</label>
                            <input type="number" class="input-field" id="marcha-fc-inicial" min="40" max="200">
                            <span>lpm</span>
                        </div>
                        <div class="measurement">
                            <label>FC final:</label>
                            <input type="number" class="input-field" id="marcha-fc-final" min="40" max="200">
                            <span>lpm</span>
                        </div>
                        <div class="measurement">
                            <label>Borg inicial:</label>
                            <select id="marcha-borg-inicial">
                                <option value="">Seleccionar</option>
                                <option value="0">0 - Sin disnea</option>
                                <option value="1">1 - Muy leve</option>
                                <option value="2">2 - Leve</option>
                                <option value="3">3 - Moderada</option>
                                <option value="4">4 - Algo severa</option>
                                <option value="5">5 - Severa</option>
                                <option value="6">6 - Severa</option>
                                <option value="7">7 - Muy severa</option>
                                <option value="8">8 - Muy severa</option>
                                <option value="9">9 - Muy, muy severa</option>
                                <option value="10">10 - M√°xima</option>
                            </select>
                        </div>
                        <div class="measurement">
                            <label>Borg final:</label>
                            <select id="marcha-borg-final">
                                <option value="">Seleccionar</option>
                                <option value="0">0 - Sin disnea</option>
                                <option value="1">1 - Muy leve</option>
                                <option value="2">2 - Leve</option>
                                <option value="3">3 - Moderada</option>
                                <option value="4">4 - Algo severa</option>
                                <option value="5">5 - Severa</option>
                                <option value="6">6 - Severa</option>
                                <option value="7">7 - Muy severa</option>
                                <option value="8">8 - Muy severa</option>
                                <option value="9">9 - Muy, muy severa</option>
                                <option value="10">10 - M√°xima</option>
                            </select>
                        </div>
                        <div class="score-item">
                            <span>Interpretaci√≥n distancia:</span>
                            <span class="score-value" id="marcha-interpretation">--</span>
                        </div>
                        <div class="score-item">
                            <span>Desaturaci√≥n:</span>
                            <span class="score-value" id="marcha-desaturacion">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="conclusion">
            <h3><i class="fas fa-file-medical-alt"></i> Conclusi√≥n del Examen Neumol√≥gico</h3>
            <div class="conclusion-text" id="conclusion-text">Seleccione los par√°metros del examen para generar la conclusi√≥n neumol√≥gica...</div>
        </div>
        
        <div class="control-buttons">
            <button class="btn btn-primary" onclick="generateConclusion()">
                <i class="fas fa-file-medical"></i> Generar Conclusi√≥n
            </button>
            <button class="btn btn-primary" onclick="printConclusion()">
                <i class="fas fa-print"></i> Imprimir Conclusi√≥n
            </button>
            <button class="btn btn-secondary" onclick="clearForm()">
                <i class="fas fa-trash"></i> Limpiar Formulario
            </button>
            <button class="btn btn-secondary" onclick="expandAllSections()">
                <i class="fas fa-expand-alt"></i> Expandir Todo
            </button>
            <button class="btn btn-secondary" onclick="collapseAllSections()">
                <i class="fas fa-compress-alt"></i> Contraer Todo
            </button>
        </div>
    </div>

    <script>
        // üé® Variables globales para el dashboard
        let examProgress = 0;
        let sectionsCompleted = 0;
        let alertCount = 0;
        let warningCount = 0;
        let findingsCount = 0;
        let completenessStatus = '0%';

        // üåô Toggle de tema
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            
            if (body.hasAttribute('data-theme')) {
                body.removeAttribute('data-theme');
                themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            }
        }

        // üéØ Toggle panel de navegaci√≥n
        function toggleNavPanel() {
            const navPanel = document.getElementById('nav-panel');
            const body = document.body;
            
            navPanel.classList.toggle('open');
            body.classList.toggle('split-view');
        }

        // üìä FUNCIONES DEL PANEL STICKY - NUEVA FUNCIONALIDAD

        // Toggle panel lateral sticky
        function toggleStickyPanel() {
            const stickyPanel = document.getElementById('stickyConclusion');
            const body = document.body;
            const btn = document.getElementById('sticky-toggle-btn');
            
            stickyPanel.classList.toggle('active');
            body.classList.toggle('split-view-active');
            
            if (stickyPanel.classList.contains('active')) {
                btn.innerHTML = '<i class="fas fa-window-restore"></i> Vista Normal';
                btn.classList.add('btn-warning');
                btn.classList.remove('btn-primary');
                generateStickyConclusion();
            } else {
                btn.innerHTML = '<i class="fas fa-columns"></i> Vista Dividida';
                btn.classList.add('btn-primary');
                btn.classList.remove('btn-warning');
            }
        }

        // Generar conclusi√≥n para panel sticky
        function generateStickyConclusion() {
            const stickyContent = document.getElementById('stickyContent');
            const updateIndicator = document.getElementById('updateIndicator');
            
            // Mostrar indicador de actualizaci√≥n
            updateIndicator.classList.add('active');
            
            setTimeout(() => {
                // Reutilizar la funci√≥n generateConclusion existente
                const originalConclusionEl = document.getElementById('conclusion-text');
                const originalContent = originalConclusionEl.textContent;
                
                // Clonar contenido al panel sticky
                stickyContent.textContent = originalContent;
                
                // Ocultar indicador
                updateIndicator.classList.remove('active');
            }, 300);
        }

        // Copiar contenido del panel sticky
        function copyStickyToClipboard() {
            const stickyContent = document.getElementById('stickyContent').textContent;
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(stickyContent).then(() => {
                    showCopyNotification();
                }).catch(err => {
                    console.error('Error al copiar con la API del portapapeles: ', err);
                    fallbackCopyToClipboard(stickyContent);
                });
            } else {
                fallbackCopyToClipboard(stickyContent);
            }
        }

        // Fallback para copiar
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                showCopyNotification();
            } catch (err) {
                console.error('Error al usar el m√©todo de respaldo para copiar: ', err);
                alert('No se pudo copiar el texto. Por favor, c√≥pielo manualmente.');
            }

            document.body.removeChild(textArea);
        }

        // Mostrar notificaci√≥n de copia
        function showCopyNotification() {
            const notification = document.getElementById('copyNotification');
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2500);
        }

        // Imprimir desde panel sticky
        function printStickyConclusion() {
            const conclusion = document.getElementById('stickyContent').textContent;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Informe Neumol√≥gico</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            line-height: 1.6;
                        }
                        pre { 
                            white-space: pre-wrap; 
                            font-family: 'Courier New', monospace; 
                            font-size: 12px;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #1abc9c;
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                        }
                        .footer {
                            text-align: center;
                            font-size: 10px;
                            color: #666;
                            margin-top: 20px;
                            border-top: 1px solid #ddd;
                            padding-top: 10px;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Informe Neumol√≥gico</h1>
                        <p>Fecha: ${new Date().toLocaleDateString()}</p>
                        <p>Hora: ${new Date().toLocaleTimeString()}</p>
                    </div>
                    <pre>${conclusion}</pre>
                    <div class="footer">
                        <p>Generado por Sistema de Evaluaci√≥n Neumol√≥gica Premium</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // üß≠ Navegaci√≥n a secciones
        function scrollToSection(sectionId) {
            const section = document.getElementById(`section-${sectionId}`);
            if (section) {
                section.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start',
                    inline: 'nearest'
                });
                
                // Expandir la secci√≥n si est√° colapsada
                const header = section.querySelector('.section-header');
                if (!header.classList.contains('expanded')) {
                    toggleSection(header);
                }
            }
        }

        // ‚úÖ Actualizar altura de secci√≥n
        function updateSectionHeight(contentElement) {
            if (contentElement && contentElement.classList.contains('expanded')) {
                setTimeout(() => {
                    contentElement.style.maxHeight = contentElement.scrollHeight + 'px';
                }, 50);
            }
        }

        // üìÇ Toggle de secciones mejorado
        function toggleSection(headerElement) {
            const content = headerElement.nextElementSibling;
            const section = headerElement.parentElement;
            
            headerElement.classList.toggle('expanded');
            section.classList.toggle('active');
            
            if (content.classList.toggle('expanded')) {
                content.style.maxHeight = content.scrollHeight + 'px';
                content.classList.add('slide-in');
            } else {
                content.style.maxHeight = '0';
                content.classList.remove('slide-in');
            }
        }

        // üîÑ Expandir/contraer todas las secciones
        function expandAllSections() {
            document.querySelectorAll('.section-header:not(.expanded)').forEach(header => {
                toggleSection(header);
            });
        }

        function collapseAllSections() {
            document.querySelectorAll('.section-header.expanded').forEach(header => {
                toggleSection(header);
            });
        }

        // üö´ Manejo de "Sin quejas"
        function handleNoComplaints() {
            const noComplaintsCheckbox = document.getElementById('sin-quejas-neumo');
            const otherCheckboxes = document.querySelectorAll('#anamnesis input[type="checkbox"]:not(#sin-quejas-neumo)');
            
            otherCheckboxes.forEach(checkbox => {
                checkbox.disabled = noComplaintsCheckbox.checked;
                if (noComplaintsCheckbox.checked) checkbox.checked = false;
            });
            
            updateDashboard();
            generateConclusion();
        }
        
        // ‚öñÔ∏è Manejo de checkboxes mutuamente excluyentes
        function handleMutuallyExclusive(positiveId, negativeId, checkbox) {
            if (checkbox.checked) {
                const oppositeId = checkbox.id === positiveId ? negativeId : positiveId;
                const oppositeCheckbox = document.getElementById(oppositeId);
                if (oppositeCheckbox) oppositeCheckbox.checked = false;
            }
            updateDashboard();
            generateConclusion();
        }

        // üö¨ Calcular paquetes/a√±o
        function calculatePackYears() {
            const cigarrillosDia = parseFloat(document.getElementById('cigarrillos-dia').value) || 0;
            const anosFumando = parseFloat(document.getElementById('anos-fumando').value) || 0;
            
            const paquetesAno = (cigarrillosDia * anosFumando) / 20;
            document.getElementById('paquetes-calculados').textContent = paquetesAno.toFixed(1);
            
            // Actualizar el campo manual si existe
            if (document.getElementById('paquetes-ano').value === '') {
                document.getElementById('paquetes-ano').value = paquetesAno.toFixed(1);
            }
            
            updateDashboard();
            generateConclusion();
        }

        // ü´Å Evaluar frecuencia respiratoria
        function evaluateRespiratoryRate() {
            const fr = parseFloat(document.getElementById('frecuencia-respiratoria').value);
            const interpretEl = document.getElementById('interpretacion-fr');
            
            if (!fr) {
                interpretEl.textContent = '--';
                return;
            }
            
            if (fr < 12) {
                interpretEl.textContent = 'Bradipnea';
                interpretEl.style.color = '#f39c12';
            } else if (fr > 20) {
                interpretEl.textContent = 'Taquipnea';
                interpretEl.style.color = '#e74c3c';
            } else {
                interpretEl.textContent = 'Normal';
                interpretEl.style.color = '#1abc9c';
            }
            updateDashboard();
            generateConclusion();
        }

        // üí® Evaluar saturaci√≥n
        function evaluateSaturation() {
            const sat = parseFloat(document.getElementById('saturacion-o2').value);
            const interpretEl = document.getElementById('interpretacion-sat');
            
            if (!sat) {
                interpretEl.textContent = '--';
                return;
            }
            
            if (sat < 88) {
                interpretEl.textContent = 'Hipoxemia severa';
                interpretEl.style.color = '#e74c3c';
            } else if (sat < 92) {
                interpretEl.textContent = 'Hipoxemia moderada';
                interpretEl.style.color = '#e74c3c';
            } else if (sat < 95) {
                interpretEl.textContent = 'Hipoxemia leve';
                interpretEl.style.color = '#f39c12';
            } else {
                interpretEl.textContent = 'Normal';
                interpretEl.style.color = '#1abc9c';
            }
            updateDashboard();
            generateConclusion();
        }

        // üìä Actualizar valor CAT
        function updateCATValue(category, value) {
            document.getElementById(`cat-${category}-value`).textContent = value;
            calculateCAT();
        }

        // üßÆ Calcular CAT
        function calculateCAT() {
            const categories = ['tos', 'flemas', 'opresion', 'disnea', 'limitacion', 'confianza', 'sueno', 'energia'];
            let total = 0;
            
            categories.forEach(category => {
                const value = parseFloat(document.getElementById(`cat-${category}`).value) || 0;
                total += value;
            });
            
            document.getElementById('cat-total').textContent = total;
            
            let interpretation = '';
            if (total < 10) {
                interpretation = 'Impacto bajo';
            } else if (total < 20) {
                interpretation = 'Impacto medio';
            } else if (total < 30) {
                interpretation = 'Impacto alto';
            } else {
                interpretation = 'Impacto muy alto';
            }
            
            document.getElementById('cat-interpretation').textContent = interpretation;
            updateDashboard();
            generateConclusion();
        }

        // üìà Calcular BODE
        function calculateBODE() {
            let total = 0;
            
            // IMC
            const imc = parseFloat(document.getElementById('bode-imc').value);
            if (imc) {
                if (imc <= 21) total += 1;
            }
            
            // FEV1
            const fev1 = parseFloat(document.getElementById('bode-fev1').value);
            if (fev1) {
                if (fev1 >= 65) total += 0;
                else if (fev1 >= 50) total += 1;
                else if (fev1 >= 36) total += 2;
                else total += 3;
            }
            
            // Disnea mMRC
            const disnea = document.querySelector('input[name="bode-disnea"]:checked');
            if (disnea) total += parseInt(disnea.value);
            
            // Ejercicio
            const ejercicio = parseFloat(document.getElementById('bode-ejercicio').value);
            if (ejercicio) {
                if (ejercicio >= 350) total += 0;
                else if (ejercicio >= 250) total += 1;
                else if (ejercicio >= 150) total += 2;
                else total += 3;
            }
            
            document.getElementById('bode-total').textContent = total;
            
            let prognosis = '';
            if (total <= 2) {
                prognosis = '80% supervivencia';
            } else if (total <= 4) {
                prognosis = '67% supervivencia';
            } else if (total <= 6) {
                prognosis = '57% supervivencia';
            } else {
                prognosis = '18% supervivencia';
            }
            
            document.getElementById('bode-prognosis').textContent = prognosis;
            updateDashboard();
            generateConclusion();
        }

        // üåÄ Calcular espirometr√≠a
        function calculateSpirometry() {
            const fvcPre = parseFloat(document.getElementById('fvc-pre').value);
            const fev1Pre = parseFloat(document.getElementById('fev1-pre').value);
            const fev1FvcPre = parseFloat(document.getElementById('fev1-fvc-pre').value);
            const fvcPost = parseFloat(document.getElementById('fvc-post').value);
            const fev1Post = parseFloat(document.getElementById('fev1-post').value);
            const fev1FvcPost = parseFloat(document.getElementById('fev1-fvc-post').value);
            
            // Calcular reversibilidad
            if (fev1Pre && fev1Post) {
                const reversibilityFEV1 = ((fev1Post - fev1Pre) / fev1Pre) * 100;
                document.getElementById('reversibility-fev1').textContent = `${reversibilityFEV1.toFixed(1)}%`;
            }
            
            if (fvcPre && fvcPost) {
                const reversibilityFVC = ((fvcPost - fvcPre) / fvcPre) * 100;
                document.getElementById('reversibility-fvc').textContent = `${reversibilityFVC.toFixed(1)}%`;
            }
            
            // Determinar patr√≥n
            let pattern = '';
            let interpretation = '';
            
            if (fev1FvcPost || fev1FvcPre) {
                const ratio = fev1FvcPost || fev1FvcPre;
                if (ratio < 70) {
                    pattern = 'Obstructivo';
                    interpretation = 'Patr√≥n obstructivo compatible con EPOC/Asma';
                } else {
                    pattern = 'Normal o Restrictivo';
                    interpretation = 'Patr√≥n normal. Evaluar vol√∫menes pulmonares si sospecha restrictivo';
                }
            }
            
            document.getElementById('spirometry-pattern').textContent = pattern;
            document.getElementById('spirometry-interpretation').textContent = interpretation;
            updateDashboard();
            generateConclusion();
        }

        // ü•á Calcular GOLD
        function calculateGOLD() {
            const fev1 = parseFloat(document.getElementById('gold-fev1').value);
            
            if (!fev1) {
                document.getElementById('gold-classification').textContent = '--';
                document.getElementById('gold-severity').textContent = '--';
                return;
            }
            
            let classification = '';
            let severity = '';
            
            if (fev1 >= 80) {
                classification = 'GOLD 1';
                severity = 'Leve';
            } else if (fev1 >= 50) {
                classification = 'GOLD 2';
                severity = 'Moderada';
            } else if (fev1 >= 30) {
                classification = 'GOLD 3';
                severity = 'Severa';
            } else {
                classification = 'GOLD 4';
                severity = 'Muy severa';
            }
            
            document.getElementById('gold-classification').textContent = classification;
            document.getElementById('gold-severity').textContent = severity;
            updateDashboard();
            generateConclusion();
        }

        // üö∂‚Äç‚ôÇÔ∏è Evaluar test de marcha
        function evaluateWalkTest() {
            const distancia = parseFloat(document.getElementById('marcha-distancia').value);
            const spo2Inicial = parseFloat(document.getElementById('marcha-spo2-inicial').value);
            const spo2Final = parseFloat(document.getElementById('marcha-spo2-final').value);
            
            if (distancia) {
                let interpretation = '';
                if (distancia >= 400) {
                    interpretation = 'Normal';
                } else if (distancia >= 300) {
                    interpretation = 'Levemente reducida';
                } else if (distancia >= 200) {
                    interpretation = 'Moderadamente reducida';
                } else {
                    interpretation = 'Severamente reducida';
                }
                document.getElementById('marcha-interpretation').textContent = interpretation;
            }
            
            if (spo2Inicial && spo2Final) {
                const desaturacion = spo2Inicial - spo2Final;
                let desatInterpretation = '';
                if (desaturacion >= 4) {
                    desatInterpretation = `S√≠ (${desaturacion.toFixed(1)}%)`;
                } else {
                    desatInterpretation = `No (${desaturacion.toFixed(1)}%)`;
                }
                document.getElementById('marcha-desaturacion').textContent = desatInterpretation;
            }
            
            updateDashboard();
            generateConclusion();
        }

        // ‚≠ê Actualizar puntuaci√≥n Borg
        function updateBorgScore() {
            const borgSelected = document.querySelector('input[name="borg-scale"]:checked');
            if (borgSelected) {
                document.getElementById('borg-score').textContent = borgSelected.value;
            } else {
                document.getElementById('borg-score').textContent = '--';
            }
            updateDashboard();
            generateConclusion();
        }

        // üéØ Auto-rellenar campos comunes
        function autoPopulateCommon() {
            // Simular examen normal b√°sico
            document.getElementById('torax-simetrico').checked = true;
            document.getElementById('torax-normal').checked = true;
            document.getElementById('respiracion-normal').checked = true;
            document.getElementById('expansibilidad-normal').checked = true;
            document.getElementById('amplitud-normal').checked = true;
            
            // Signos vitales normales
            document.getElementById('frecuencia-respiratoria').value = '16';
            document.getElementById('saturacion-o2').value = '98';
            
            // Ruidos respiratorios normales
            ['der-apice', 'der-superior', 'der-medio', 'der-inferior',
             'izq-apice', 'izq-superior', 'izq-medio', 'izq-inferior'].forEach(zona => {
                const ruidoId = `ruidos-${zona}-vesicular`;
                const fremitoId = `fremito-${zona}-normal`;
                const percusionId = `percusion-${zona}-sonoro`;
                
                const ruidoEl = document.getElementById(ruidoId);
                const fremitoEl = document.getElementById(fremitoId);
                const percusionEl = document.getElementById(percusionId);
                
                if (ruidoEl) ruidoEl.checked = true;
                if (fremitoEl) fremitoEl.checked = true;
                if (percusionEl) percusionEl.checked = true;
            });
            
            updateDashboard();
            generateConclusion();
        }

        // üìä ACTUALIZAR DASHBOARD
        function updateDashboard() {
            // Contar elementos completados en cada secci√≥n
            const sections = [
                'anamnesis', 'thoracic-inspection', 'thoracic-palpation', 
                'thoracic-percussion', 'pulmonary-auscultation', 'respiratory-scales', 'spirometry'
            ];
            
            let completedSections = 0;
            let totalFindings = 0;
            let totalAlerts = 0;
            let totalWarnings = 0;
            
            sections.forEach(sectionId => {
                const sectionElement = document.getElementById(sectionId);
                if (sectionElement) {
                    const checkboxes = sectionElement.querySelectorAll('input[type="checkbox"]:checked, input[type="radio"]:checked');
                    const numbers = sectionElement.querySelectorAll('input[type="number"]');
                    const selects = sectionElement.querySelectorAll('select');
                    const ranges = sectionElement.querySelectorAll('input[type="range"]');
                    
                    let hasContent = checkboxes.length > 0;
                    
                    // Verificar campos num√©ricos
                    numbers.forEach(input => {
                        if (input.value && input.value !== '0') hasContent = true;
                    });
                    
                    // Verificar selects
                    selects.forEach(select => {
                        if (select.selectedIndex > 0) hasContent = true;
                    });
                    
                    // Verificar ranges
                    ranges.forEach(input => {
                        if (input.value && input.value !== '0') hasContent = true;
                    });
                    
                    if (hasContent) {
                        completedSections++;
                        totalFindings += checkboxes.length;
                        
                        // Marcar secci√≥n como completada
                        const badge = document.getElementById(`badge-${sectionId}`);
                        const navItem = document.getElementById(`nav-${sectionId}`);
                        
                        if (badge) {
                            badge.classList.add('completed');
                            badge.innerHTML = '<i class="fas fa-check"></i>';
                        }
                        
                        if (navItem) {
                            navItem.style.opacity = '1';
                            navItem.parentElement.classList.add('completed');
                        }
                        
                        // Contar alertas y warnings espec√≠ficos
                        checkboxes.forEach(checkbox => {
                            const label = checkbox.nextElementSibling ? checkbox.nextElementSibling.textContent.toLowerCase() : '';
                            
                            // Criterios de alerta para neumolog√≠a
                            if (label.includes('taquipnea') || label.includes('bradipnea') || 
                                label.includes('cianosis') || label.includes('hipoxemia') ||
                                label.includes('abolido') || label.includes('mate') ||
                                checkbox.id.includes('confusion') || checkbox.id.includes('estridor')) {
                                totalAlerts++;
                            }
                            // Criterios de warning
                            else if (label.includes('disnea') || label.includes('tos') ||
                                    label.includes('sibilancias') || label.includes('crepitantes') ||
                                    label.includes('disminuido') || label.includes('asim√©tric')) {
                                totalWarnings++;
                            }
                        });
                    } else {
                        // Limpiar marcas de completado
                        const badge = document.getElementById(`badge-${sectionId}`);
                        const navItem = document.getElementById(`nav-${sectionId}`);
                        
                        if (badge) {
                            badge.classList.remove('completed');
                            badge.innerHTML = '<i class="fas fa-circle"></i>';
                        }
                        
                        if (navItem) {
                            navItem.style.opacity = '0';
                            navItem.parentElement.classList.remove('completed');
                        }
                    }
                }
            });
            
            // Actualizar valores del dashboard
            const progress = Math.round((completedSections / sections.length) * 100);
            document.getElementById('exam-progress').textContent = `${progress}%`;
            document.getElementById('sections-completed').textContent = `${completedSections}/${sections.length}`;
            document.getElementById('alert-count').textContent = totalAlerts;
            document.getElementById('warning-count').textContent = totalWarnings;
            document.getElementById('findings-count').textContent = totalFindings;
            document.getElementById('completeness-status').textContent = `${progress}%`;
            
            // Actualizar clases del dashboard seg√∫n alertas
            const alertsItem = document.getElementById('alerts-item');
            const warningsItem = document.getElementById('warnings-item');
            const findingsItem = document.getElementById('findings-item');
            
            alertsItem.style.display = totalAlerts > 0 ? 'block' : 'block';
            warningsItem.style.display = totalWarnings > 0 ? 'block' : 'block';
            
            // Guardar valores globales
            examProgress = progress;
            sectionsCompleted = completedSections;
            alertCount = totalAlerts;
            warningCount = totalWarnings;
            findingsCount = totalFindings;
            completenessStatus = `${progress}%`;
        }

        // üìù GENERAR CONCLUSI√ìN MEJORADA (Estilo narrativo m√©dico)
        function generateConclusion() {
            const conclusionEl = document.getElementById('conclusion-text');
            let conclusion = 'INFORME DEL EXAMEN NEUMOL√ìGICO:\n\n';

            // Funci√≥n auxiliar para obtener el texto de la etiqueta asociada
            const getLabelText = (id) => document.querySelector(`label[for="${id}"]`)?.textContent.toLowerCase() || '';
            // Funci√≥n auxiliar para verificar si un input (checkbox/radio) est√° marcado
            const isChecked = (id) => document.getElementById(id)?.checked;
            // Funci√≥n auxiliar para obtener el valor de un input num√©rico
            const getInputValue = (id) => document.getElementById(id)?.value;
            // Funci√≥n auxiliar para obtener el valor de un input de texto
            const getTextInputValue = (id) => document.getElementById(id)?.value?.trim() || '';
            // Funci√≥n auxiliar para unir hallazgos en una frase con conectores m√©dicos
            const formatMedicalList = (arr) => {
                if (arr.length === 0) return '';
                if (arr.length === 1) return arr[0];
                if (arr.length === 2) return `${arr[0]} y ${arr[1]}`;
                return `${arr.slice(0, -1).join(', ')} y ${arr[arr.length - 1]}`;
            };

            // --- 1. QUEJAS PRINCIPALES ---
            let anamnesisSection = 'ANAMNESIS Y QUEJAS PRINCIPALES:\n';
            let hasAnamnesisFindings = false;

            if (isChecked('sin-quejas-neumo')) {
                anamnesisSection += 'El paciente se encuentra asintom√°tico desde el punto de vista respiratorio. ';
                hasAnamnesisFindings = true;
            } else {
                const complaints = [];
                ['disnea', 'tos', 'expectoracion', 'dolor-toracico', 'hemoptisis', 'sibilancias',
                 'ortopnea', 'disnea-paroxistica', 'cianosis', 'ronquidos', 'apneas', 'fiebre',
                 'sudoracion-nocturna', 'perdida-peso'].forEach(id => {
                    if (isChecked(id)) complaints.push(getLabelText(id));
                });

                if (complaints.length > 0) {
                    anamnesisSection += `Quejas principales: ${formatMedicalList(complaints)}. `;
                    hasAnamnesisFindings = true;
                }
            }

            // Evaluaci√≥n de la disnea
            const mmrcSelected = document.querySelector('input[name="mmrc-dyspnea"]:checked');
            const disneaTiempo = getInputValue('disnea-tiempo');
            const disneaUnidad = document.getElementById('disnea-unidad').value;

            if (mmrcSelected || disneaTiempo) {
                anamnesisSection += 'Evaluaci√≥n de disnea: ';
                if (mmrcSelected) {
                    const mmrcLabel = document.querySelector(`label[for="${mmrcSelected.id}"]`).textContent;
                    anamnesisSection += `${mmrcLabel}. `;
                }
                if (disneaTiempo) anamnesisSection += `Tiempo de evoluci√≥n: ${disneaTiempo} ${disneaUnidad}. `;
                hasAnamnesisFindings = true;
            }

            // Caracter√≠sticas de la tos
            const tosSelected = document.querySelector('input[name="tipo-tos"]:checked');
            const tosDuracion = getInputValue('tos-duracion');
            const expectoracionVolumen = getInputValue('expectoracion-volumen');
            const expectoracionColor = document.querySelector('input[name="color-expectoracion"]:checked');

            if (tosSelected || tosDuracion || expectoracionVolumen || expectoracionColor) {
                anamnesisSection += 'Evaluaci√≥n de tos: ';
                if (tosSelected) {
                    const tosLabel = document.querySelector(`label[for="${tosSelected.id}"]`).textContent;
                    anamnesisSection += `${tosLabel}. `;
                }
                if (tosDuracion) {
                    const tosDuracionUnidad = document.getElementById('tos-duracion-unidad').value;
                    anamnesisSection += `Duraci√≥n: ${tosDuracion} ${tosDuracionUnidad}. `;
                }
                if (expectoracionVolumen) anamnesisSection += `Volumen expectoraci√≥n: ${expectoracionVolumen} ml/d√≠a. `;
                if (expectoracionColor) {
                    const colorLabel = document.querySelector(`label[for="${expectoracionColor.id}"]`).textContent;
                    anamnesisSection += `Color expectoraci√≥n: ${colorLabel}. `;
                }
                hasAnamnesisFindings = true;
            }

            if (hasAnamnesisFindings) {
                conclusion += anamnesisSection.trim() + '\n\n';
            }

            // --- 2. H√ÅBITO TAB√ÅQUICO Y FACTORES DE RIESGO ---
            let riskFactorsSection = 'FACTORES DE RIESGO:\n';
            let hasRiskFactors = false;

            const tabacSelected = document.querySelector('input[name="tabaquismo"]:checked');
            const paquetesAno = document.getElementById('paquetes-calculados').textContent;

            if (tabacSelected) {
                const tabacLabel = document.querySelector(`label[for="${tabacSelected.id}"]`).textContent;
                riskFactorsSection += `H√°bito tab√°quico: ${tabacLabel}. `;
                if (paquetesAno !== '0') riskFactorsSection += `Paquetes/a√±o: ${paquetesAno}. `;
                hasRiskFactors = true;
            }

            const exposiciones = [];
            ['asbesto', 'silice', 'carbon', 'polvos-organicos', 'vapores-quimicos', 'soldadura'].forEach(id => {
                if (isChecked(id)) exposiciones.push(getLabelText(id));
            });
            if (exposiciones.length > 0) {
                riskFactorsSection += `Exposiciones ocupacionales: ${formatMedicalList(exposiciones)}. `;
                hasRiskFactors = true;
            }

            const antecedentes = [];
            ['asma', 'epoc', 'neumonia-previa', 'tuberculosis', 'neumotorax', 'tromboembolismo',
             'cancer-pulmon', 'fibrosis-pulmonar'].forEach(id => {
                if (isChecked(id)) antecedentes.push(getLabelText(id));
            });
            if (antecedentes.length > 0) {
                riskFactorsSection += `Antecedentes patol√≥gicos: ${formatMedicalList(antecedentes)}. `;
                hasRiskFactors = true;
            }

            if (hasRiskFactors) {
                conclusion += riskFactorsSection.trim() + '\n\n';
            }

            // --- 3. EXAMEN F√çSICO ---
            let physicalExamSection = 'EXAMEN F√çSICO:\n';
            let hasPhysicalFindings = false;

            // Signos vitales y oximetr√≠a
            const fr = getInputValue('frecuencia-respiratoria');
            const frInterpretacion = document.getElementById('interpretacion-fr').textContent;
            const sat = getInputValue('saturacion-o2');
            const satInterpretacion = document.getElementById('interpretacion-sat').textContent;
            const fio2 = getInputValue('fio2');

            if (fr || sat) {
                physicalExamSection += 'Signos vitales: ';
                if (fr) physicalExamSection += `FR: ${fr} rpm (${frInterpretacion}). `;
                if (sat) {
                    physicalExamSection += `SatO2: ${sat}%`;
                    if (fio2) physicalExamSection += ` con FiO2 ${fio2}%`;
                    physicalExamSection += ` (${satInterpretacion}). `;
                }
                hasPhysicalFindings = true;
            }

            // Configuraci√≥n tor√°cica
            const formaTorax = document.querySelector('input[name="forma-torax"]:checked');
            const patronRespiratorio = document.querySelector('input[name="patron-respiratorio"]:checked');

            if (formaTorax || patronRespiratorio) {
                physicalExamSection += 'Inspecci√≥n: ';
                if (formaTorax) {
                    const formaLabel = document.querySelector(`label[for="${formaTorax.id}"]`).textContent;
                    physicalExamSection += `T√≥rax ${formaLabel.toLowerCase()}. `;
                }
                if (patronRespiratorio) {
                    const patronLabel = document.querySelector(`label[for="${patronRespiratorio.id}"]`).textContent;
                    physicalExamSection += `Patr√≥n respiratorio: ${patronLabel.toLowerCase()}. `;
                }
                hasPhysicalFindings = true;
            }

            // Expansibilidad y fr√©mito
            const expansibilidad = isChecked('expansibilidad-normal') ? 'sim√©trica' : 
                                 isChecked('expansibilidad-asimetrica') ? 'asim√©trica' : null;
            const amplitud = isChecked('amplitud-normal') ? 'normal' : 
                           isChecked('amplitud-disminuida') ? 'disminuida' : null;

            if (expansibilidad || amplitud) {
                physicalExamSection += 'Palpaci√≥n: ';
                if (expansibilidad) physicalExamSection += `Expansibilidad ${expansibilidad}. `;
                if (amplitud) physicalExamSection += `Amplitud de expansi√≥n ${amplitud}. `;
                hasPhysicalFindings = true;
            }

            // Auscultaci√≥n - ruidos normales
            const ruidosNormales = [];
            const ruidosPatologicos = [];
            
            // Verificar ruidos por zona
            ['der-apice', 'der-superior', 'der-medio', 'der-inferior',
             'izq-apice', 'izq-superior', 'izq-medio', 'izq-inferior'].forEach(zona => {
                const ruido = document.querySelector(`input[name="ruidos-${zona}"]:checked`);
                if (ruido && ruido.value !== 'vesicular') {
                    ruidosPatologicos.push(`${ruido.value} en ${zona.replace('der-', 'pulm√≥n derecho ').replace('izq-', 'pulm√≥n izquierdo ')}`);
                }
            });

            // Ruidos adventicios
            const adventicios = [];
            document.querySelectorAll('input[id*="crepitantes"]:checked, input[id*="subcrepitantes"]:checked, input[id*="sibilancias"]:checked, input[id*="roncus"]:checked, input[id*="estridor"]:checked, input[id*="roce"]:checked').forEach(cb => {
                const parts = cb.id.split('-');
                const tipo = parts[0];
                const lado = parts[1] === 'der' ? 'derecho' : 'izquierdo';
                const zona = parts[2];
                adventicios.push(`${tipo} en pulm√≥n ${lado} ${zona}`);
            });

            if (ruidosPatologicos.length > 0 || adventicios.length > 0) {
                physicalExamSection += 'Auscultaci√≥n: ';
                if (ruidosPatologicos.length > 0) {
                    physicalExamSection += `Ruidos respiratorios: ${formatMedicalList(ruidosPatologicos)}. `;
                }
                if (adventicios.length > 0) {
                    physicalExamSection += `Ruidos adventicios: ${formatMedicalList(adventicios)}. `;
                }
                hasPhysicalFindings = true;
            } else {
                physicalExamSection += 'Auscultaci√≥n: Ruidos respiratorios vesiculares bilaterales, sin ruidos adventicios. ';
                hasPhysicalFindings = true;
            }

            if (hasPhysicalFindings) {
                conclusion += physicalExamSection.trim() + '\n\n';
            }

            // --- 4. ESCALAS DE EVALUACI√ìN ---
            let scalesSection = 'ESCALAS DE EVALUACI√ìN:\n';
            let hasScalesFindings = false;

            const catTotal = document.getElementById('cat-total').textContent;
            const catInterpretation = document.getElementById('cat-interpretation').textContent;
            const bodeTotal = document.getElementById('bode-total').textContent;
            const bodePrognosis = document.getElementById('bode-prognosis').textContent;

            if (catTotal !== '0') {
                scalesSection += `Test CAT: ${catTotal}/40 puntos (${catInterpretation}). `;
                hasScalesFindings = true;
            }
            if (bodeTotal !== '0') {
                scalesSection += `√çndice BODE: ${bodeTotal}/10 puntos (${bodePrognosis}). `;
                hasScalesFindings = true;
            }

            const borgScore = document.getElementById('borg-score').textContent;
            if (borgScore !== '--') {
                scalesSection += `Escala de Borg: ${borgScore}/10. `;
                hasScalesFindings = true;
            }

            if (hasScalesFindings) {
                conclusion += scalesSection.trim() + '\n\n';
            }

            // --- 5. PRUEBAS FUNCIONALES ---
            let functionalSection = 'PRUEBAS FUNCIONALES:\n';
            let hasFunctionalFindings = false;

            const spirometryPattern = document.getElementById('spirometry-pattern').textContent;
            const spirometryInterpretation = document.getElementById('spirometry-interpretation').textContent;
            const goldClassification = document.getElementById('gold-classification').textContent;
            const goldSeverity = document.getElementById('gold-severity').textContent;

            if (spirometryPattern !== '--') {
                functionalSection += `Espirometr√≠a: Patr√≥n ${spirometryPattern.toLowerCase()}. `;
                if (spirometryInterpretation !== '--') {
                    functionalSection += `${spirometryInterpretation}. `;
                }
                hasFunctionalFindings = true;
            }

            if (goldClassification !== '--') {
                functionalSection += `Clasificaci√≥n GOLD: ${goldClassification} (${goldSeverity}). `;
                hasFunctionalFindings = true;
            }

            const marchaDistancia = getInputValue('marcha-distancia');
            const marchaInterpretation = document.getElementById('marcha-interpretation').textContent;
            const marchaDesaturacion = document.getElementById('marcha-desaturacion').textContent;

            if (marchaDistancia) {
                functionalSection += `Test de marcha 6 minutos: ${marchaDistancia} metros (${marchaInterpretation}). `;
                if (marchaDesaturacion !== '--') {
                    functionalSection += `Desaturaci√≥n: ${marchaDesaturacion}. `;
                }
                hasFunctionalFindings = true;
            }

            if (hasFunctionalFindings) {
                conclusion += functionalSection.trim() + '\n\n';
            }

            // --- RESUMEN FINAL ---
            if (conclusion.trim() === 'INFORME DEL EXAMEN NEUMOL√ìGICO:') {
                conclusion = 'Seleccione los par√°metros del examen para generar la conclusi√≥n neumol√≥gica...';
            } else {
                conclusion += 'RESUMEN Y CONCLUSI√ìN:\n';
                if (alertCount > 0) {
                    conclusion += `Se identifican ${alertCount} **hallazgos cr√≠ticos** que requieren atenci√≥n inmediata. `;
                }
                if (warningCount > 0) {
                    conclusion += `Existen ${warningCount} **hallazgos importantes** que deben ser considerados. `;
                }
                if (findingsCount > 0) {
                    conclusion += `Un total de ${findingsCount} hallazgos relevantes han sido registrados en este examen. `;
                } else {
                    conclusion += `El examen no ha revelado hallazgos patol√≥gicos significativos. `;
                }
                conclusion += '\n\n';

                conclusion += 'IMPRESI√ìN DIAGN√ìSTICA:\n';
                conclusion += '[Pendiente de correlaci√≥n cl√≠nica y estudios complementarios]\n\n';
                conclusion += 'PLAN:\n';
                conclusion += '[A determinar seg√∫n hallazgos cl√≠nicos e imagenol√≥gicos]\n\n';
                conclusion += 'SEGUIMIENTO:\n';
                conclusion += '[Control seg√∫n patolog√≠a respiratoria sospechada]\n\n';
                conclusion += `COMPLETITUD DEL EXAMEN: ${examProgress}%`;
            }

            conclusionEl.textContent = conclusion;
            
            // Actualizar panel sticky si est√° activo
            const stickyPanel = document.getElementById('stickyConclusion');
            if (stickyPanel && stickyPanel.classList.contains('active')) {
                // Peque√±o retardo para asegurar que el DOM se actualice antes de copiar
                setTimeout(() => generateStickyConclusion(), 100); 
            }
        }

        // üñ®Ô∏è Imprimir conclusi√≥n
        function printConclusion() {
            const conclusion = document.getElementById('conclusion-text').textContent;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Conclusi√≥n Examen Neumol√≥gico</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            line-height: 1.6;
                        }
                        pre { 
                            white-space: pre-wrap; 
                            font-family: 'Courier New', monospace; 
                            font-size: 12px;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #1abc9c;
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                        }
                        .footer {
                            text-align: center;
                            font-size: 10px;
                            color: #666;
                            margin-top: 20px;
                            border-top: 1px solid #ddd;
                            padding-top: 10px;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Examen Neumol√≥gico - Conclusi√≥n</h1>
                        <p>Fecha: ${new Date().toLocaleDateString()}</p>
                    </div>
                    <pre>${conclusion}</pre>
                    <div class="footer">
                        <p>Generado por Sistema de Evaluaci√≥n Neumol√≥gica Avanzado</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // üóëÔ∏è Limpiar formulario
        function clearForm() {
            if (confirm('¬øEst√° seguro de que desea limpiar todos los datos del formulario?')) {
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    cb.disabled = false;
                });
                document.querySelectorAll('input[type="radio"]').forEach(rb => rb.checked = false);
                document.querySelectorAll('input[type="number"]').forEach(nb => nb.value = '');
                document.querySelectorAll('input[type="range"]').forEach(rb => rb.value = 0);
                document.querySelectorAll('select').forEach(sel => sel.selectedIndex = 0);
                document.querySelectorAll('textarea').forEach(ta => ta.value = '');
                
                // Resetear valores espec√≠ficos de CAT
                ['tos', 'flemas', 'opresion', 'disnea', 'limitacion', 'confianza', 'sueno', 'energia'].forEach(cat => {
                    document.getElementById(`cat-${cat}-value`).textContent = '0';
                });
                
                // Resetear valores calculados
                document.getElementById('paquetes-calculados').textContent = '0';
                document.getElementById('interpretacion-fr').textContent = '--';
                document.getElementById('interpretacion-sat').textContent = '--';
                document.getElementById('cat-total').textContent = '0';
                document.getElementById('cat-interpretation').textContent = '--';
                document.getElementById('bode-total').textContent = '0';
                document.getElementById('bode-prognosis').textContent = '--';
                document.getElementById('borg-score').textContent = '--';
                document.getElementById('spirometry-pattern').textContent = '--';
                document.getElementById('spirometry-interpretation').textContent = '--';
                document.getElementById('reversibility-fev1').textContent = '--';
                document.getElementById('reversibility-fvc').textContent = '--';
                document.getElementById('gold-classification').textContent = '--';
                document.getElementById('gold-severity').textContent = '--';
                document.getElementById('marcha-interpretation').textContent = '--';
                document.getElementById('marcha-desaturacion').textContent = '--';
                
                // Actualizar dashboard
                updateDashboard();
                generateConclusion();
            }
        }
        
        // üöÄ Inicializaci√≥n del sistema
        document.addEventListener('DOMContentLoaded', () => {
            // Cargar tema guardado
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                document.getElementById('theme-icon').className = 'fas fa-sun';
            }

            // Event listeners para inputs generales
            document.querySelectorAll('input, select, textarea').forEach(el => {
                el.addEventListener('change', () => {
                    updateDashboard();
                    generateConclusion();
                });
                el.addEventListener('input', () => {
                    updateDashboard();
                    generateConclusion();
                });
            });
             
            // Event listeners espec√≠ficos para c√°lculos
            document.querySelectorAll('input[name="borg-scale"]').forEach(el => {
                el.addEventListener('change', updateBorgScore);
            });

            // Event listeners para CAT sliders
            ['tos', 'flemas', 'opresion', 'disnea', 'limitacion', 'confianza', 'sueno', 'energia'].forEach(category => {
                document.getElementById(`cat-${category}`).addEventListener('input', () => {
                    updateCATValue(category, document.getElementById(`cat-${category}`).value);
                });
            });
             
            // Ajustar altura de secciones cuando cambian
            document.querySelector('.main-container').addEventListener('change', (event) => {
                const sectionContent = event.target.closest('.section-content.expanded');
                if (sectionContent) {
                    updateSectionHeight(sectionContent);
                }
            });
             
            // Expandir la primera secci√≥n por defecto
            toggleSection(document.querySelector('.section-header'));
            
            // Inicializar evaluaciones
            evaluateRespiratoryRate();
            evaluateSaturation();
            calculatePackYears();
            calculateCAT();
            calculateBODE();
            calculateSpirometry();
            calculateGOLD();
            evaluateWalkTest();
            updateBorgScore();
            updateDashboard();
            generateConclusion();

            // Mostrar mensaje de bienvenida
            setTimeout(() => {
                console.log('üéâ Sistema de Evaluaci√≥n Neumol√≥gica Avanzado con Panel Sticky cargado exitosamente!');
            }, 1000);
        });
    </script>
</body>
</html>